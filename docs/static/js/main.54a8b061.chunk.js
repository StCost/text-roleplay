(this["webpackJsonptext-roleplay"]=this["webpackJsonptext-roleplay"]||[]).push([[0],{182:function(e){e.exports=JSON.parse('{"apiKey":"AIzaSyC_NJqbSuXGDiD6hcQZdmtBZnaVZ40ggIY","authDomain":"text-roleplay.firebaseapp.com","databaseURL":"https://text-roleplay.firebaseio.com","projectId":"text-roleplay","storageBucket":"text-roleplay.appspot.com","messagingSenderId":"226797822488","appId":"1:226797822488:web:e717b14d3ccc42e700996d"}')},190:function(e,t,a){e.exports=a(360)},199:function(e,t,a){},201:function(e,t,a){},349:function(e,t,a){},360:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),c=a.n(s),o=a(20),i=(a(199),a(51)),u=(a(200),a(365)),l=a(45),g=a(93),m=a(104),d=a(102),p=a(368),S=a(367),f=a(362),E=a(366),b=(a(201),a(32)),v=a(7),O=a(41),h=a(185),j=a(163),y=a(135),w=JSON.parse(localStorage.getItem("user")||"null");w&&localStorage.setItem("uid",w.uid);var I={user:w,isLoggedIn:null!==w,settings:!1,loading:!1,messages:[],users:{}},T={nickname:"",avatar:"",uid:"",lastOnline:0},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":case"GET_MESSAGES":case"GET_MORE_MESSAGES":case"SEND_MESSAGE":case"GET_SETTINGS":case"UPLOAD_FILE":case"SET_SETTINGS":return Object(v.a)(Object(v.a)({},e),{},{loading:!0});case"LOGIN_FAIL":case"GET_MESSAGES_FAIL":case"GET_MORE_MESSAGES_SUCCESS":case"GET_MORE_MESSAGES_FAIL":case"SEND_MESSAGE_FAIL":case"GET_SETTINGS_FAIL":case"SET_SETTINGS_SUCCESS":case"SET_SETTINGS_FAIL":return Object(v.a)(Object(v.a)({},e),{},{loading:!1});case"LOGIN_SUCCESS":return Object(v.a)(Object(v.a)({},e),{},{user:t.user,isLoggedIn:null!==t.user});case"LOGOUT":return Object(v.a)(Object(v.a)({},e),{},{user:null,isLoggedIn:!1});case"GET_MESSAGES_SUCCESS":var a=t.concat?[].concat(Object(y.a)(e.messages),Object(y.a)(t.messages)):t.messages;return Object(v.a)(Object(v.a)({},e),{},{messages:a.sort((function(e,t){return t.time-e.time})).filter((function(e,t,a){return a.findIndex((function(t){return t.time===e.time}))===t})),loading:!1});case"GET_SETTINGS_SUCCESS":return Object(v.a)(Object(v.a)({},e),{},{settings:t.settings||T,loading:!1});case"GET_USER_SUCCESS":return Object(v.a)(Object(v.a)({},e),{},{users:Object(v.a)(Object(v.a)({},e.users),{},Object(b.a)({},t.user.uid,t.user))});default:return e}},x=Object(h.a)(),G=Object(O.createStore)(_,I,Object(j.composeWithDevTools)(Object(O.applyMiddleware)(x))),M=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",r=0;r<3;r++){n+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return n},k=function(e){return(e||parseInt(localStorage.getItem("lastActivity")||"0"))+18e4>(new Date).getTime()},L=function(e){return 1==="".concat(e).length?"0".concat(e):e},A=function(e){var t=new Date(e);return[t.getHours(),t.getMinutes(),t.getSeconds()].map(L).join(":")},N=function(e){var t=new Date(e);return[t.getDate(),t.getMonth()+1,t.getFullYear()].map(L).join(".")},C=function(e){var t=new Date(e);return[[t.getHours(),t.getMinutes(),t.getSeconds()].map(L).join(":"),[t.getDate(),t.getMonth()+1,t.getFullYear()].map(L).join(".")].join(" ")},D=G.dispatch,U=function(e){return function(t){return D(Object(v.a)({type:e},t))}},F=function(e){var t,a=e.toLowerCase().replace(/_./g,(function(e){return e.toUpperCase()})).replace(/_/g,"");return t={},Object(b.a)(t,a,U(e)),Object(b.a)(t,"".concat(a,"Success"),U("".concat(e,"_SUCCESS"))),Object(b.a)(t,"".concat(a,"Fail"),U("".concat(e,"_FAIL"))),t},R=Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)({},F("LOGIN")),F("GET_USER")),F("GET_MESSAGES")),F("GET_MORE_MESSAGES")),F("GET_SETTINGS")),F("SET_SETTINGS")),F("SEND_MESSAGE")),F("SUBSCRIBE")),F("UNSUBSCRIBE")),F("UPLOAD_FILE")),{},{updateLastOnline:U("UPDATE_LAST_ONLINE"),logout:U("LOGOUT")}),B=a(183),P=a(364),z=a(187),K=a(361),J=function(e){var t=e.avatar,a=e.nickname,n=e.style,s=Object(z.a)(e,["avatar","nickname","style"]);return r.a.createElement(K.a,Object.assign({src:t,style:Object(v.a)(Object(v.a)({},n),{},{backgroundColor:t?"transparent":M(a)})},s),a)},W=function(e){var t,a=e.message;if(t=a,new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)){if(/\.(gif|jpe?g|tiff|png|webp|bmp)$/i.test(a))return r.a.createElement("img",{src:a,alt:""});if(/youtu/.test(a)){var n=new URL(a).searchParams.get("v")||"";return r.a.createElement("iframe",{title:n,id:"ytplayer",width:"100%",height:"360",src:"http://www.youtube.com/embed/".concat(n),frameBorder:"0"})}return r.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},a)}return r.a.createElement("span",null,a)},q=function(e){var t=e.message,a=t.time,n=t.body,s=e.user,c=s&&r.a.createElement(i.b,{to:"./user/".concat(s.uid)},r.a.createElement(B.a,{title:"Last activity: ".concat(C(s.lastOnline)),placement:"left"},r.a.createElement("div",{className:"chat-message__title ".concat(k(s.lastOnline)?"online":"")},r.a.createElement(J,{avatar:s.avatar,nickname:s.nickname}),r.a.createElement("div",{className:"chat-message__nickname"},s.nickname))));return r.a.createElement(P.a,{className:"chat-message",title:c,key:a,extra:r.a.createElement(B.a,{title:N(a)},r.a.createElement("div",{className:"chat-time"},A(a)))},r.a.createElement(W,{message:n}))},H=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={message:"",sending:!1},e.componentDidMount=function(){R.getMessages({}),R.subscribe({}),e.setState({message:localStorage.getItem("message")||""})},e.componentWillUnmount=function(){R.unsubscribe({})},e.componentDidUpdate=function(t){var a=e.props,n=a.messages,r=a.users;e.state.sending&&t.messages!==n&&(localStorage.setItem("message",""),e.setState({message:"",sending:!1})),n.forEach((function(e){r[e.author]||R.getUser({uid:e.author})}))},e.onChangeMessage=function(t){var a=t.target.value;localStorage.setItem("message",a),e.setState({message:a})},e.onKeyDown=function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.onSendMessage())},e.onSendMessage=function(){var t=e.state.message,a=e.props,n=a.settings,r=a.user;a.loading||(r&&n?n.nickname?t?(e.setState({sending:!0}),R.sendMessage({uid:r.uid,message:t})):S.a.error("Message is empty"):S.a.error("User name is not defined. Go to settings and set it"):S.a.error("Not logged in. How are you even here? Contact administration"))},e.getMoreMessages=function(){R.getMoreMessages({firstMessage:e.props.messages[e.props.messages.length-1]})},e.onScroll=function(t){t.currentTarget.scrollTop<=50&&e.getMoreMessages()},e.uploadFile=function(t,a){var n=e.props.user;t&&n&&(t.type.indexOf("image")>-1?R.uploadFile({uid:n.uid,file:t}):S.a.error("Only images can be uploaded"),a.preventDefault())},e.onPaste=function(t){e.uploadFile(t.clipboardData.files[0],t)},e.onDrop=function(t){var a=t.dataTransfer.items[0].getAsFile();a&&e.uploadFile(a,t)},e.render=function(){var t=e.props,a=t.messages,n=t.loading,s=t.users;return r.a.createElement(f.a,{spinning:n},r.a.createElement("div",{className:"chat-wrapper"},r.a.createElement("div",{className:"chat-body",onScroll:e.onScroll},a.map((function(e){return r.a.createElement(q,{key:e.time,message:e,user:s[e.author]})}))),r.a.createElement("div",{className:"chat-controls"},r.a.createElement(E.a.TextArea,{placeholder:"Enter message",autoSize:{minRows:1,maxRows:10},onChange:e.onChangeMessage,onKeyDown:e.onKeyDown,value:e.state.message,onPaste:e.onPaste,onDrop:e.onDrop}),r.a.createElement(p.a,{onClick:e.onSendMessage}))))},e}return a}(n.Component),V=Object(o.b)((function(e){return{messages:e.messages,user:e.user,settings:e.settings,loading:e.loading,users:e.users}}))(H),Y=a(136),Z=a(134),$=a(73),X=a(369),Q=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state=T,e.componentDidMount=function(){var t=e.props.user;t&&R.getSettings({uid:t.uid})},e.onChange=function(t){return function(a){return e.setState(Object(b.a)({},t,a.target.value))}},e.getNewSettings=function(){var t=e.props.settings,a={};return Object.entries(t).forEach((function(t){var n=Object(Y.a)(t,2),r=n[0],s=n[1];a[r]=e.state[r]||s})),a},e.onSubmit=function(){e.setSettings(e.getNewSettings())},e.setSettings=function(t){var a=e.props.user;a&&R.setSettings({uid:a.uid,settings:t})},e.getField=function(t,a){var n=e.props,s=n.loading,c=n.settings,o=e.state,i=o.avatar,u=o.nickname;switch(t){case"avatar":return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(E.a,{defaultValue:i||a,onChange:e.onChange(t),disabled:s}),r.a.createElement(Z.a,{onClick:function(){return e.setSettings(Object(v.a)(Object(v.a)({},e.getNewSettings()),{},{avatar:""}))},disabled:!(i||a)},r.a.createElement(X.a,null))),r.a.createElement(J,{avatar:i||a,nickname:u||c&&c.nickname||"",size:128,style:{margin:"8px auto",display:"block"}}));case"uid":case"lastOnline":return!1;default:return r.a.createElement(E.a,{defaultValue:a,onChange:e.onChange(t),disabled:s})}},e.render=function(){var t=e.props,a=t.settings,n=t.loading;return a?r.a.createElement("div",null,r.a.createElement(f.a,{spinning:n},Object.entries(a).map((function(t){var a=Object(Y.a)(t,2),n=a[0],s=a[1],c=e.getField(n,s);return c&&r.a.createElement(P.a,{key:n,title:n.toUpperCase()},c)}))),r.a.createElement(Z.a,{onClick:e.onSubmit,disabled:n},"Submit")):r.a.createElement($.a,null)},e}return a}(r.a.Component),ee=Object(o.b)((function(e){return{settings:e.settings,loading:e.loading,user:e.user}}))(Q),te=[{label:"Chat",path:"/text-roleplay/chat",component:V},{label:"Settings",path:"/text-roleplay/settings",component:ee},{label:"Logout",path:"/text-roleplay/logout",component:Object(o.b)()((function(){return r.a.createElement("div",null,r.a.createElement(K.a,{src:"https://cdn.lowgif.com/full/fc3d7d9abd06a92e-hi-bear-gifs-get-the-best-gif-on-giphy.gif",size:256,style:{margin:"0 auto",display:"block"}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Z.a,{type:"primary",size:"large",onClick:function(){return R.logout({})},style:{width:"100%"}},"Logout"))}))}];var ae=Object(o.b)()(Object(l.g)((function(e){return r.a.createElement(u.a,{style:{width:256},mode:"inline",selectedKeys:[e.location.pathname]},te.map((function(t){return r.a.createElement(u.a.Item,{key:t.path,disabled:t.path===e.location.pathname},r.a.createElement(i.b,{to:t.path},t.label))})))}))),ne=a(363),re=Object(o.b)()((function(){return r.a.createElement(ne.a,{onFinish:function(e){return R.login(e)}},r.a.createElement(ne.a.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email!"}]},r.a.createElement(E.a,null)),r.a.createElement(ne.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(E.a.Password,null)),r.a.createElement(ne.a.Item,null,r.a.createElement(Z.a,{type:"primary",htmlType:"submit"},"Login")))}));var se=Object(o.b)((function(e){return{isLoggedIn:e.isLoggedIn}}))((function(e){return e.isLoggedIn?r.a.createElement(l.d,null,te.map((function(e){return r.a.createElement(l.b,{key:e.path,path:e.path,component:e.component})})),r.a.createElement(l.a,{to:"/text-roleplay/chat"})):r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"*",component:re}))}));a(349);var ce=function(){return function(){var e=function(){k(parseInt(localStorage.getItem("lastActivity")||"0")-6e4)||R.updateLastOnline({})};["mousedown","mousemove","keydown","scroll","touchstart"].forEach((function(t){document.addEventListener(t,e,!0)})),e()}(),r.a.createElement(i.a,null,r.a.createElement(ae,null),r.a.createElement("div",{className:"app"},r.a.createElement(se,null)))},oe=a(15),ie=a.n(oe),ue=a(25),le=a(106),ge=a(182),me=(Object(le.initializeApp)(ge),Object(le.auth)()),de=Object(le.database)();me.onAuthStateChanged((function(e){e?(R.loginSuccess({user:e}),R.getSettings({uid:e.uid})):R.logout({})}));var pe=ie.a.mark(ye),Se=ie.a.mark(we),fe=ie.a.mark(Ie),Ee=ie.a.mark(Te),be=ie.a.mark(_e),ve=ie.a.mark(Me),Oe=ie.a.mark(ke),he=ie.a.mark(Ne),je=ie.a.mark(De);function ye(e){var t,a,n,r;return ie.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.email,a=e.password,s.prev=1,s.next=4,me.signInWithEmailAndPassword(t,a);case 4:n=s.sent,R.loginSuccess({user:n}),localStorage.setItem("user",JSON.stringify(n.user)),localStorage.setItem("uid",n.uid),s.next=23;break;case 10:if(s.prev=10,s.t0=s.catch(1),console.error(s.t0),"auth/user-not-found"!==s.t0.code){s.next=22;break}return s.next=16,me.createUserWithEmailAndPassword(t,a);case 16:r=s.sent,R.loginSuccess({user:r}),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("uid",r.uid),s.next=23;break;case 22:R.loginFail({error:s.t0});case 23:case"end":return s.stop()}}),pe,null,[[1,10]])}function we(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.removeItem("user"),localStorage.removeItem("uid"),localStorage.removeItem("loggedIn"),e.next=5,me.signOut();case 5:case"end":return e.stop()}}),Se)}function Ie(e){var t,a,n;return ie.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.uid,r.prev=1,r.next=4,de.ref("users").child(t).once("value");case 4:a=r.sent,n=a.val(),R.getSettingsSuccess({settings:n}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),console.error(r.t0),R.getSettingsFail({error:r.t0});case 13:case"end":return r.stop()}}),fe,null,[[1,9]])}function Te(e){var t,a;return ie.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.uid,a=e.settings,n.prev=1,n.next=4,de.ref("users").child(t).set(Object(v.a)(Object(v.a)({},a),{},{uid:t}));case 4:R.setSettingsSuccess({}),R.getSettings({uid:t}),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error(n.t0),R.setSettingsFail({error:n.t0});case 12:case"end":return n.stop()}}),Ee,null,[[1,8]])}function _e(e){var t,a,n;return ie.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.uid,a=e.message,n=(new Date).getTime(),r.prev=2,r.next=5,de.ref("messages").child("".concat(n)).set({time:n,author:t,body:a});case 5:localStorage.setItem("message",""),R.sendMessageSuccess({}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(2),console.error(r.t0),R.sendMessageFail({error:r.t0});case 13:case"end":return r.stop()}}),be,null,[[2,9]])}function xe(){de.ref("messages").orderByKey().limitToLast(1).on("value",(function(e){var t=Object.values(e.val()||{});R.getMessagesSuccess({messages:t,concat:!0})}))}function Ge(){de.ref("messages").off()}function Me(){var e,t;return ie.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,de.ref("messages").orderByKey().limitToLast(30).once("value");case 2:e=a.sent,t=Object.values(e.val()||{}),R.getMessagesSuccess({messages:t});case 5:case"end":return a.stop()}}),ve)}function ke(e){var t,a,n;return ie.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.firstMessage,r.next=3,de.ref("messages").orderByKey().endAt("".concat(t.time)).limitToLast(5).once("value");case 3:a=r.sent,n=Object.values(a.val()||{}),R.getMessagesSuccess({messages:n,concat:!0});case 6:case"end":return r.stop()}}),Oe)}var Le={};function Ae(e){var t=e.uid;Le[t]||(Le[t]=!0,de.ref("users").child(t).on("value",(function(e){var t=e.val()||{};R.getUserSuccess({user:t})})))}function Ne(){var e,t;return ie.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e=localStorage.getItem("uid")){a.next=3;break}return a.abrupt("return");case 3:return t=(new Date).getTime(),localStorage.setItem("lastActivity","".concat(t)),a.next=7,de.ref("users").child("".concat(e)).child("lastOnline").set(t);case 7:case"end":return a.stop()}}),he)}function Ce(e){var t=e.file,a=e.uid,n=new XMLHttpRequest,r=new FormData;r.append("image",t),n.open("POST","https://api.imgur.com/3/image/"),n.setRequestHeader("Authorization","Client-ID ea2c833b74d4583"),n.onreadystatechange=function(){if(200===n.status&&4===n.readyState){var e=JSON.parse(n.responseText);R.sendMessage({uid:a,message:e.data.link})}},n.send(r)}function De(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ue.a)("LOGIN",ye);case 2:return e.next=4,Object(ue.a)("LOGOUT",we);case 4:return e.next=6,Object(ue.a)("GET_SETTINGS",Ie);case 6:return e.next=8,Object(ue.a)("GET_USER",Ae);case 8:return e.next=10,Object(ue.a)("SET_SETTINGS",Te);case 10:return e.next=12,Object(ue.a)("SEND_MESSAGE",_e);case 12:return e.next=14,Object(ue.a)("GET_MESSAGES",Me);case 14:return e.next=16,Object(ue.a)("GET_MORE_MESSAGES",ke);case 16:return e.next=18,Object(ue.a)("SUBSCRIBE",xe);case 18:return e.next=20,Object(ue.a)("UPDATE_LAST_ONLINE",Ne);case 20:return e.next=22,Object(ue.a)("UNSUBSCRIBE",Ge);case 22:return e.next=24,Object(ue.a)("UPLOAD_FILE",Ce);case 24:case"end":return e.stop()}}),je)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));x.run(De),c.a.render(r.a.createElement(o.a,{store:G},r.a.createElement(ce,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[190,1,2]]]);
//# sourceMappingURL=main.54a8b061.chunk.js.map