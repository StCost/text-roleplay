(this["webpackJsonptext-roleplay"]=this["webpackJsonptext-roleplay"]||[]).push([[0],{182:function(e){e.exports=JSON.parse('{"apiKey":"AIzaSyC_NJqbSuXGDiD6hcQZdmtBZnaVZ40ggIY","authDomain":"text-roleplay.firebaseapp.com","databaseURL":"https://text-roleplay.firebaseio.com","projectId":"text-roleplay","storageBucket":"text-roleplay.appspot.com","messagingSenderId":"226797822488","appId":"1:226797822488:web:e717b14d3ccc42e700996d"}')},190:function(e,t,a){e.exports=a(360)},199:function(e,t,a){},201:function(e,t,a){},349:function(e,t,a){},360:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),c=a.n(s),o=a(20),i=(a(199),a(51)),u=(a(200),a(365)),l=a(45),g=a(93),m=a(104),d=a(102),S=a(368),p=a(367),E=a(362),f=a(366),b=(a(201),a(32)),v=a(7),O=a(41),h=a(185),j=a(162),y=a(134),I=JSON.parse(localStorage.getItem("user")||"null");localStorage.setItem("uid",I.uid);var w={user:I,isLoggedIn:null!==I,settings:!1,loading:!1,messages:[],users:{}},T={nickname:"",avatar:"",uid:"",lastOnline:0},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":case"GET_MESSAGES":case"GET_MORE_MESSAGES":case"SEND_MESSAGE":case"GET_SETTINGS":case"SET_SETTINGS":return Object(v.a)(Object(v.a)({},e),{},{loading:!0});case"LOGIN_FAIL":case"GET_MESSAGES_FAIL":case"GET_MORE_MESSAGES_SUCCESS":case"GET_MORE_MESSAGES_FAIL":case"SEND_MESSAGE_FAIL":case"GET_SETTINGS_FAIL":case"SET_SETTINGS_SUCCESS":case"SET_SETTINGS_FAIL":return Object(v.a)(Object(v.a)({},e),{},{loading:!1});case"LOGIN_SUCCESS":return Object(v.a)(Object(v.a)({},e),{},{user:t.user,isLoggedIn:null!==t.user});case"LOGOUT":return Object(v.a)(Object(v.a)({},e),{},{user:null,isLoggedIn:!1});case"GET_MESSAGES_SUCCESS":var a=t.concat?[].concat(Object(y.a)(e.messages),Object(y.a)(t.messages)):t.messages;return Object(v.a)(Object(v.a)({},e),{},{messages:a.sort((function(e,t){return t.time-e.time})).filter((function(e,t,a){return a.findIndex((function(t){return t.time===e.time}))===t})),loading:!1});case"GET_SETTINGS_SUCCESS":return Object(v.a)(Object(v.a)({},e),{},{settings:t.settings||T,loading:!1});case"GET_USER_SUCCESS":return Object(v.a)(Object(v.a)({},e),{},{users:Object(v.a)(Object(v.a)({},e.users),{},Object(b.a)({},t.user.uid,t.user))});default:return e}},G=Object(h.a)(),x=Object(O.createStore)(_,w,Object(j.composeWithDevTools)(Object(O.applyMiddleware)(G))),M=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",r=0;r<3;r++){n+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return n},k=function(e){return(e||parseInt(localStorage.getItem("lastActivity")||"0"))+18e4>(new Date).getTime()},N=function(e){return 1==="".concat(e).length?"0".concat(e):e},C=function(e){var t=new Date(e);return[t.getHours(),t.getMinutes(),t.getSeconds()].map(N).join(":")},A=function(e){var t=new Date(e);return[t.getDate(),t.getMonth()+1,t.getFullYear()].map(N).join(".")},L=function(e){var t=new Date(e);return[[t.getHours(),t.getMinutes(),t.getSeconds()].map(N).join(":"),[t.getDate(),t.getMonth()+1,t.getFullYear()].map(N).join(".")].join(" ")},U=x.dispatch,D=function(e){return function(t){return U(Object(v.a)({type:e},t))}},F=function(e){var t,a=e.toLowerCase().replace(/_./g,(function(e){return e.toUpperCase()})).replace(/_/g,"");return t={},Object(b.a)(t,a,D(e)),Object(b.a)(t,"".concat(a,"Success"),D("".concat(e,"_SUCCESS"))),Object(b.a)(t,"".concat(a,"Fail"),D("".concat(e,"_FAIL"))),t},B=Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)({},F("LOGIN")),F("GET_USER")),F("GET_MESSAGES")),F("GET_MORE_MESSAGES")),F("GET_SETTINGS")),F("SET_SETTINGS")),F("SEND_MESSAGE")),F("SUBSCRIBE")),F("UNSUBSCRIBE")),{},{updateLastOnline:D("UPDATE_LAST_ONLINE"),logout:D("LOGOUT")}),R=a(183),K=a(364),P=a(187),J=a(361),z=function(e){var t=e.avatar,a=e.nickname,n=e.style,s=Object(P.a)(e,["avatar","nickname","style"]);return r.a.createElement(J.a,Object.assign({src:t,style:Object(v.a)(Object(v.a)({},n),{},{backgroundColor:t?"transparent":M(a)})},s),a)},W=function(e){var t=e.message,a=t.time,n=t.body,s=e.user,c=s&&r.a.createElement(i.b,{to:"./user/".concat(s.uid)},r.a.createElement(R.a,{title:"Last activity: ".concat(L(s.lastOnline)),placement:"left"},r.a.createElement("div",{className:"chat-message__title ".concat(k(s.lastOnline)?"online":"")},r.a.createElement(z,{avatar:s.avatar,nickname:s.nickname}),r.a.createElement("div",{className:"chat-message__nickname"},s.nickname))));return r.a.createElement(K.a,{className:"chat-message",title:c,key:a,extra:r.a.createElement(R.a,{title:A(a)},r.a.createElement("div",{className:"chat-time"},C(a)))},n)},q=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={message:"",sending:!1},e.componentDidMount=function(){B.getMessages({}),B.subscribe({}),e.setState({message:localStorage.getItem("message")||""})},e.componentWillUnmount=function(){B.unsubscribe({})},e.componentDidUpdate=function(t){var a=e.props,n=a.messages,r=a.users;e.state.sending&&t.messages!==n&&(localStorage.setItem("message",""),e.setState({message:"",sending:!1})),n.forEach((function(e){r[e.author]||B.getUser({uid:e.author})}))},e.onChangeMessage=function(t){var a=t.target.value;localStorage.setItem("message",a),e.setState({message:a})},e.onKeyDown=function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.onSendMessage())},e.onSendMessage=function(){var t=e.state.message,a=e.props,n=a.settings,r=a.user;a.loading||(r&&n?n.nickname?t?(e.setState({sending:!0}),B.sendMessage({uid:r.uid,message:t})):p.a.error("Message is empty"):p.a.error("User name is not defined. Go to settings and set it"):p.a.error("Not logged in. How are you even here? Contact administration"))},e.getMoreMessages=function(){B.getMoreMessages({firstMessage:e.props.messages[e.props.messages.length-1]})},e.onScroll=function(t){t.target.scrollTop<=50&&e.getMoreMessages()},e.render=function(){var t=e.props,a=t.messages,n=t.loading,s=t.users;return r.a.createElement(E.a,{spinning:n},r.a.createElement("div",{className:"chat-wrapper"},r.a.createElement("div",{className:"chat-body",onScroll:e.onScroll},a.map((function(e){return r.a.createElement(W,{key:e.time,message:e,user:s[e.author]})}))),r.a.createElement("div",{className:"chat-controls"},r.a.createElement(f.a.TextArea,{placeholder:"Enter message",autoSize:{minRows:1,maxRows:10},onChange:e.onChangeMessage,onKeyDown:e.onKeyDown,value:e.state.message}),r.a.createElement(S.a,{onClick:e.onSendMessage}))))},e}return a}(n.Component),H=Object(o.b)((function(e){return{messages:e.messages,user:e.user,settings:e.settings,loading:e.loading,users:e.users}}))(q),V=a(135),Y=a(133),Z=a(73),Q=a(369),X=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state=T,e.componentDidMount=function(){var t=e.props.user;t&&B.getSettings({uid:t.uid})},e.onChange=function(t){return function(a){return e.setState(Object(b.a)({},t,a.target.value))}},e.getNewSettings=function(){var t=e.props.settings,a={};return Object.entries(t).forEach((function(t){var n=Object(V.a)(t,2),r=n[0],s=n[1];a[r]=e.state[r]||s})),a},e.onSubmit=function(){e.setSettings(e.getNewSettings())},e.setSettings=function(t){var a=e.props.user;a&&B.setSettings({uid:a.uid,settings:t})},e.getField=function(t,a){var n=e.props,s=n.loading,c=n.settings,o=e.state,i=o.avatar,u=o.nickname;switch(t){case"avatar":return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(f.a,{defaultValue:i||a,onChange:e.onChange(t),disabled:s}),r.a.createElement(Y.a,{onClick:function(){return e.setSettings(Object(v.a)(Object(v.a)({},e.getNewSettings()),{},{avatar:""}))},disabled:!(i||a)},r.a.createElement(Q.a,null))),r.a.createElement(z,{avatar:i||a,nickname:u||c&&c.nickname||"",size:128,style:{margin:"8px auto",display:"block"}}));case"uid":case"lastOnline":return!1;default:return r.a.createElement(f.a,{defaultValue:a,onChange:e.onChange(t),disabled:s})}},e.render=function(){var t=e.props,a=t.settings,n=t.loading;return a?r.a.createElement("div",null,r.a.createElement(E.a,{spinning:n},Object.entries(a).map((function(t){var a=Object(V.a)(t,2),n=a[0],s=a[1],c=e.getField(n,s);return c&&r.a.createElement(K.a,{key:n,title:n.toUpperCase()},c)}))),r.a.createElement(Y.a,{onClick:e.onSubmit,disabled:n},"Submit")):r.a.createElement(Z.a,null)},e}return a}(r.a.Component),$=Object(o.b)((function(e){return{settings:e.settings,loading:e.loading,user:e.user}}))(X),ee=[{label:"Chat",path:"/text-roleplay/chat",component:H},{label:"Settings",path:"/text-roleplay/settings",component:$},{label:"Logout",path:"/text-roleplay/logout",component:Object(o.b)()((function(){return r.a.createElement("div",null,r.a.createElement(J.a,{src:"https://cdn.lowgif.com/full/fc3d7d9abd06a92e-hi-bear-gifs-get-the-best-gif-on-giphy.gif",size:256,style:{margin:"0 auto",display:"block"}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(Y.a,{type:"primary",size:"large",onClick:function(){return B.logout({})},style:{width:"100%"}},"Logout"))}))}];var te=Object(o.b)()(Object(l.g)((function(e){return r.a.createElement(u.a,{style:{width:256},mode:"inline",selectedKeys:[e.location.pathname]},ee.map((function(t){return r.a.createElement(u.a.Item,{key:t.path,disabled:t.path===e.location.pathname},r.a.createElement(i.b,{to:t.path},t.label))})))}))),ae=a(363),ne=Object(o.b)()((function(){return r.a.createElement(ae.a,{onFinish:function(e){return B.login(e)}},r.a.createElement(ae.a.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email!"}]},r.a.createElement(f.a,null)),r.a.createElement(ae.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(f.a.Password,null)),r.a.createElement(ae.a.Item,null,r.a.createElement(Y.a,{type:"primary",htmlType:"submit"},"Login")))}));var re=Object(o.b)((function(e){return{isLoggedIn:e.isLoggedIn}}))((function(e){return e.isLoggedIn?r.a.createElement(l.d,null,ee.map((function(e){return r.a.createElement(l.b,{key:e.path,path:e.path,component:e.component})})),r.a.createElement(l.a,{to:"/text-roleplay/chat"})):r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"*",component:ne}))}));a(349);var se=function(){return function(){var e=function(){k(parseInt(localStorage.getItem("lastActivity")||"0")-6e4)||B.updateLastOnline({})};["mousedown","mousemove","keydown","scroll","touchstart"].forEach((function(t){document.addEventListener(t,e,!0)})),e()}(),r.a.createElement(i.a,null,r.a.createElement(te,null),r.a.createElement("div",{className:"app"},r.a.createElement(re,null)))},ce=a(15),oe=a.n(ce),ie=a(28),ue=a(181),le=a.n(ue),ge=a(182),me=le.a.initializeApp(ge),de=me.auth(),Se=me.database();de.onAuthStateChanged((function(e){e?(B.loginSuccess({user:e}),B.getSettings({uid:e.uid})):B.logout({})}));var pe=oe.a.mark(Ie),Ee=oe.a.mark(we),fe=oe.a.mark(Te),be=oe.a.mark(_e),ve=oe.a.mark(Ge),Oe=oe.a.mark(ke),he=oe.a.mark(Ne),je=oe.a.mark(Le),ye=oe.a.mark(Ue);function Ie(e){var t,a,n,r;return oe.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.email,a=e.password,s.prev=1,s.next=4,de.signInWithEmailAndPassword(t,a);case 4:n=s.sent,B.loginSuccess({user:n}),localStorage.setItem("user",JSON.stringify(n.user)),localStorage.setItem("uid",n.uid),s.next=14;break;case 10:s.prev=10,s.t0=s.catch(1),console.error(s.t0),"auth/user-not-found"===s.t0.code?(r=de.createUserWithEmailAndPassword(t,a),B.loginSuccess({user:r}),localStorage.setItem("user",JSON.stringify(r))):B.loginFail({error:s.t0});case 14:case"end":return s.stop()}}),pe,null,[[1,10]])}function we(){return oe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.removeItem("user"),localStorage.removeItem("uid"),localStorage.removeItem("loggedIn"),e.next=5,de.signOut();case 5:case"end":return e.stop()}}),Ee)}function Te(e){var t,a,n;return oe.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.uid,r.prev=1,r.next=4,Se.ref("users").child(t).once("value");case 4:a=r.sent,n=a.val(),B.getSettingsSuccess({settings:n}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),console.error(r.t0),B.getSettingsFail({error:r.t0});case 13:case"end":return r.stop()}}),fe,null,[[1,9]])}function _e(e){var t,a;return oe.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.uid,a=e.settings,n.prev=1,n.next=4,Se.ref("users").child(t).set(Object(v.a)(Object(v.a)({},a),{},{uid:t}));case 4:B.setSettingsSuccess({}),B.getSettings({uid:t}),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error(n.t0),B.setSettingsFail({error:n.t0});case 12:case"end":return n.stop()}}),be,null,[[1,8]])}function Ge(e){var t,a,n;return oe.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.uid,a=e.message,n=(new Date).getTime(),r.prev=2,r.next=5,Se.ref("messages").child("".concat(n)).set({time:n,author:t,body:a});case 5:localStorage.setItem("message",""),B.sendMessageSuccess({}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(2),console.error(r.t0),B.sendMessageFail({error:r.t0});case 13:case"end":return r.stop()}}),ve,null,[[2,9]])}function xe(){Se.ref("messages").orderByKey().limitToLast(1).on("value",(function(e){var t=Object.values(e.val()||{});B.getMessagesSuccess({messages:t,concat:!0})}))}function Me(){Se.ref("messages").off()}function ke(){var e,t;return oe.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Se.ref("messages").orderByKey().limitToLast(30).once("value");case 2:e=a.sent,t=Object.values(e.val()||{}),B.getMessagesSuccess({messages:t});case 5:case"end":return a.stop()}}),Oe)}function Ne(e){var t,a,n;return oe.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.firstMessage,r.next=3,Se.ref("messages").orderByKey().endAt("".concat(t.time)).limitToLast(5).once("value");case 3:a=r.sent,n=Object.values(a.val()||{}),B.getMessagesSuccess({messages:n,concat:!0});case 6:case"end":return r.stop()}}),he)}var Ce={};function Ae(e){var t=e.uid;Ce[t]||(Ce[t]=!0,Se.ref("users").child(t).on("value",(function(e){var t=e.val()||{};B.getUserSuccess({user:t})})))}function Le(){var e,t;return oe.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e=localStorage.getItem("uid")){a.next=3;break}return a.abrupt("return");case 3:return t=(new Date).getTime(),localStorage.setItem("lastActivity","".concat(t)),a.next=7,Se.ref("users").child("".concat(e)).child("lastOnline").set(t);case 7:case"end":return a.stop()}}),je)}function Ue(){return oe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ie.a)("LOGIN",Ie);case 2:return e.next=4,Object(ie.a)("LOGOUT",we);case 4:return e.next=6,Object(ie.a)("GET_SETTINGS",Te);case 6:return e.next=8,Object(ie.a)("GET_USER",Ae);case 8:return e.next=10,Object(ie.a)("SET_SETTINGS",_e);case 10:return e.next=12,Object(ie.a)("SEND_MESSAGE",Ge);case 12:return e.next=14,Object(ie.a)("GET_MESSAGES",ke);case 14:return e.next=16,Object(ie.a)("GET_MORE_MESSAGES",Ne);case 16:return e.next=18,Object(ie.a)("SUBSCRIBE",xe);case 18:return e.next=20,Object(ie.a)("UPDATE_LAST_ONLINE",Le);case 20:return e.next=22,Object(ie.a)("UNSUBSCRIBE",Me);case 22:case"end":return e.stop()}}),ye)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));G.run(Ue),c.a.render(r.a.createElement(o.a,{store:x},r.a.createElement(se,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[190,1,2]]]);
//# sourceMappingURL=main.20d5f0f5.chunk.js.map