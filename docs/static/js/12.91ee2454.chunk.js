(this["webpackJsonptext-roleplay"]=this["webpackJsonptext-roleplay"]||[]).push([[12,39],{155:function(a,e,t){"use strict";t.r(e);var s=t(104),l=t(44),n=t(4),r=t(6),c=t.n(r),i=t(184),m=t(70),o=t(72),h=t(71),u=t(0),p=t.n(u),d=t(26),E=t(35),b=t(437),f=t(150),v=t(30),g=t(68),N=t(508),k=t(101),O=t(435),x=t(67),y=t(470),C=t(33),j=t(448),S=t(525),I=(t(456),t(86)),M=t(3),w=t(22),A=function(a){Object(o.a)(t,a);var e=Object(h.a)(t);function t(){var a;Object(m.a)(this,t);for(var r=arguments.length,o=new Array(r),h=0;h<r;h++)o[h]=arguments[h];return(a=e.call.apply(e,[this].concat(o))).state=I.initialCharacter,a.componentDidMount=function(){var e=a.props,t=e.character,s=e.uid,l=e.user;t||M.default.getCharacter({uid:s}),l||M.default.getUser({uid:s})},a.getSpecial=function(){var e=a.props.hasRight;return p.a.createElement(b.a,{className:"char-special"},p.a.createElement("div",{className:"char-special-item"},p.a.createElement("span",{className:"char-special-label"}),p.a.createElement("div",{className:"char-special-input total"},"Total"),p.a.createElement("div",{className:"char-special-input"},"+/-"),p.a.createElement("div",{className:"char-special-input"},"Base")),I.special.map((function(a){var t=a.label,s=a.full,l=a.field;return p.a.createElement("div",{key:t,className:"char-special-item"},p.a.createElement(f.a,{title:s},p.a.createElement("span",{className:"char-special-label"},t)),p.a.createElement(v.a.Item,{name:["special",l,"total"]},p.a.createElement(g.a,{className:"char-special-input total",readOnly:!0,min:0,max:9,disabled:!e})),p.a.createElement(v.a.Item,{name:["special",l,"change"]},p.a.createElement(N.a,{className:"char-special-input",min:0,max:9,disabled:!e})),p.a.createElement(v.a.Item,{name:["special",l,"base"]},p.a.createElement(N.a,{className:"char-special-input",min:0,max:9,disabled:!e})))})))},a.getSkills=function(){var e=a.props.hasRight;return p.a.createElement(b.a,{className:"char-skills"},p.a.createElement("div",{className:"char-skills-item"},p.a.createElement("span",{className:"char-skills-label"}),p.a.createElement("div",{className:"char-skills-input total"},"Total"),p.a.createElement("div",{className:"char-skills-input"},"+/-"),p.a.createElement("div",{className:"char-skills-input"},"Base")),I.skills.map((function(a){var t=a.label,s=a.full,l=a.formula,n=a.field;return p.a.createElement("div",{key:n,className:"char-skills-item"},p.a.createElement(f.a,{title:s},p.a.createElement("span",{className:"char-skills-label"},t)),p.a.createElement(v.a.Item,{name:["skills",n,"total"]},p.a.createElement(g.a,{className:"char-skills-input",readOnly:!0,disabled:!e})),p.a.createElement(v.a.Item,{name:["skills",n,"change"]},p.a.createElement(N.a,{className:"char-skills-input",disabled:!e,min:1,max:95})),p.a.createElement(f.a,{title:l},p.a.createElement(v.a.Item,{name:["skills",n,"base"]},p.a.createElement(g.a,{className:"char-skills-input",readOnly:!0,disabled:!e}))))})))},a.getStats=function(){var e=a.props.hasRight;return p.a.createElement(b.a,{className:"char-stats"},I.stats.map((function(a){var t=a.label,s=a.full,l=a.field,n=a.getBase;return p.a.createElement("div",{key:l,className:"char-stats-item"},p.a.createElement(f.a,{title:s},p.a.createElement("span",{className:"char-stats-label"},t)),p.a.createElement(v.a.Item,{name:["stats",l]},"wounds"===l?p.a.createElement(g.a.TextArea,{className:"char-stats-input",disabled:!e}):n?p.a.createElement(g.a,{className:"char-stats-input",readOnly:!0,disabled:!e}):p.a.createElement(N.a,{className:"char-stats-input",min:1,max:Number.MAX_SAFE_INTEGER,disabled:!e})))})))},a.getMainStats=function(){var e=a.props.hasRight;return p.a.createElement(b.a,{className:"char-main-stats"},p.a.createElement("div",{className:"char-main-stats-health"},p.a.createElement("div",{className:"char-main-stats-hp"},p.a.createElement("span",{className:"char-main-stats-hp-label"},"\u041e\u0447\u043a\u0438 \u0417\u0434\u043e\u0440\u043e\u0432\u044c\u044f (\u041e\u0417)"),p.a.createElement("div",{className:"char-main-stats-hp-body"},p.a.createElement(v.a.Item,{name:["stats","healthPoints"]},p.a.createElement(N.a,{max:a.state.stats.maxHealthPoints||void 0,min:-Math.floor(a.state.stats.maxHealthPoints/2),disabled:!e})),"/",p.a.createElement(v.a.Item,{name:["stats","maxHealthPoints"]},p.a.createElement(g.a,{readOnly:!0,disabled:!e})))),p.a.createElement("div",{className:"char-main-stats-ap-wrapper"},p.a.createElement("div",{className:"char-main-stats-ap"},p.a.createElement(f.a,{title:"\u041a\u043b\u0430\u0441\u0441 \u0411\u0440\u043e\u043d\u0438 (\u041a\u0411)"},p.a.createElement("div",{className:"char-main-stats-ap-total"},"\u041a\u0411")),p.a.createElement("div",{className:"char-main-stats-ap-change"},"+/-"),p.a.createElement("div",{className:"char-main-stats-ap-base"},"Base")),p.a.createElement("div",{className:"char-main-stats-ap"},p.a.createElement(v.a.Item,{name:["stats","armorClass","total"]},p.a.createElement(g.a,{className:"char-main-stats-ap-total",readOnly:!0,disabled:!e})),p.a.createElement(v.a.Item,{name:["stats","armorClass","change"]},p.a.createElement(N.a,{className:"char-main-stats-ap-change",min:1,max:95,disabled:!e})),p.a.createElement(v.a.Item,{name:["stats","armorClass","base"]},p.a.createElement(g.a,{className:"char-main-stats-ap-base",readOnly:!0,disabled:!e}))))),p.a.createElement("div",{className:"char-main-stats-info"},I.subStats.slice(3).map((function(a){var t=a.label,s=a.full,l=a.field;return p.a.createElement("div",{key:l,className:"char-main-stats-item"},p.a.createElement(f.a,{title:s},p.a.createElement("span",{className:"char-main-stats-item-label"},t)),p.a.createElement(v.a.Item,{name:["stats",l]},p.a.createElement(g.a,{className:"char-main-stats-item-input",readOnly:!0,disabled:!e})))}))))},a.onChange=function(){var e=Object(i.a)(c.a.mark((function e(t,s){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.bio){e.next=4;break}a.setState({bio:t.bio}),e.next=9;break;case 4:return e.t0=a,e.next=7,a.processChar(t,s);case 7:e.t1=e.sent,e.t0.setState.call(e.t0,e.t1);case 9:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}(),a.processChar=function(){var a=Object(i.a)(c.a.mark((function a(e,t){var s,r,i,m;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t.special,r=t.skills,i=t.stats,e.bio||(m={},I.special.forEach((function(a){var e=a.field,t=a.label,l=s[e],r=Math.max(0,Math.min(9,l.base+l.change));s[e]=Object(n.a)(Object(n.a)({},l),{},{total:r}),m[t.toLowerCase()]=r})),i.spentSkillPoints=0,I.skills.forEach((function(a){var e=a.field,t=a.getBase,s=r[e],l=Math.max(1,s.change),n=Math.max(1,t?t(m,i):1),c=Math.max(1,Math.min(95,n+l));r[e]={change:l,base:n,total:c},i.spentSkillPoints+=s.change-1})),[].concat(Object(l.a)(I.stats),Object(l.a)(I.subStats)).forEach((function(a){var e=a.field,t=a.getBase;if(t)if("armorClass"===e){var s=t(m,i),l=i[e].change;i[e]={change:l,base:s,total:l+s}}else i[e]=Math.floor(t(m,i))}))),a.abrupt("return",{special:s,skills:r,stats:i});case 3:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}(),a.getChanges=function(a,e){var t=Object(S.diff)(e,a),l=Object(S.diff)(a,e),n=[];return Object.entries(t).forEach((function(a){var e=Object(s.a)(a,2),t=e[0],r=e[1];"bio"!==t||"string"!==typeof r?"object"===typeof r&&!Array.isArray(r)&&l[t]&&Object.entries(r).forEach((function(a){var e=Object(s.a)(a,2),r=e[0],c=e[1],i=l[t][r],m=Object(I.getConfigByField)(r);m&&n.push({label:m.label,full:m.full,before:c,after:i})})):n.push({label:"Bio",full:"\u0411\u0438\u043e\u0433\u0440\u0430\u0444\u0438\u044f",before:r,after:l[t]})})),n},a.onSave=function(){var e=a.props,t=e.uid,s=e.character,l=a.state;if(s){var n=a.getChanges(I.initialCharacter,l);0!==n.length&&0!==(n=a.getChanges(s||I.initialCharacter,l)).length?l.stats.skillPoints<0?k.a.error("\u041e\u0447\u043a\u0438 \u041d\u0430\u0432\u044b\u043a\u043e\u0432 (\u041e\u041d) \u043d\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438!"):(k.a.success("\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d"),console.log(l),M.default.setCharacter({uid:t,character:l}),M.default.sendMessage({uid:t,message:"\u0425\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b",data:{characterChanges:n}})):k.a.error("\u0412 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c")}else k.a.error("\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d!")},a.render=function(){var e=a.props,t=e.user,s=e.hasRight,l=e.currentUser,n=e.history,r=e.character;return t&&r?t&&t.uid&&l&&l.uid===t.uid&&"/stats"===n.location.pathname?p.a.createElement(d.a,{from:"/stats",to:"/".concat(l.uid,"/stats"),exact:!0}):p.a.createElement(v.a,{initialValues:r,onValuesChange:a.onChange},p.a.createElement(b.a,{className:"char",title:p.a.createElement(p.a.Fragment,null,p.a.createElement(j.a,null)," ","\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u0438\u0433\u0440\u043e\u043a\u0430 ",t.nickname||t.uid),extra:p.a.createElement(y.a,{title:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",okText:"\u0414\u0430",cancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",onConfirm:a.onSave},p.a.createElement(C.a,null,"\u0413\u043e\u0442\u043e\u0432\u043e"))},p.a.createElement("div",{className:"char-bio"},p.a.createElement(g.a.TextArea,{disabled:!s,minLength:3,value:a.state.bio||r.bio,onChange:function(e){return a.setState({bio:e.currentTarget.value})}})),p.a.createElement("div",null,a.getMainStats()),p.a.createElement("div",null,p.a.createElement("div",null,a.getSpecial(),a.getStats()),p.a.createElement("div",null,a.getSkills())))):p.a.createElement(O.a,{spinning:!0},p.a.createElement(x.a,{description:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d"}))},a}return t}(u.Component);e.default=Object(d.g)(Object(E.b)((function(a,e){var t=Object(w.getStateUser)(a,e),s=t.user,l=t.currentUser,r=t.character,c=!!s&&!!l&&(l.uid===s.uid&&r&&!r.static||!!l.isSuperAdmin);return Object(n.a)(Object(n.a)({},t),{},{hasRight:c})}))(A))},456:function(a,e,t){}}]);
//# sourceMappingURL=12.91ee2454.chunk.js.map