(this["webpackJsonptext-roleplay"]=this["webpackJsonptext-roleplay"]||[]).push([[11,28,35],{151:function(e,a,t){"use strict";t.r(a);var l=t(102),n=t(64),s=t(4),r=t(6),i=t.n(r),c=t(179),u=t(97),m=t(99),o=t(98),f=t(0),d=t.n(f),h=t(25),p=t(35),b=t(430),g=t(147),E=t(28),v=t(68),N=t(495),k=t(96),B=t(515),x=t(67),C=t(467),S=t(32),y=t(434),O=t(512),P=(t(443),t(250)),G=t(3),M=function(e){Object(m.a)(t,e);var a=Object(o.a)(t);function t(){var e;Object(u.a)(this,t);for(var r=arguments.length,m=new Array(r),o=0;o<r;o++)m[o]=arguments[o];return(e=a.call.apply(a,[this].concat(m))).state=P.initialCharacter,e.componentDidMount=function(){var a=e.props,t=a.user,l=a.uid;t||G.default.getUser({uid:l})},e.getSpecial=function(){var a=e.props.hasRight;return d.a.createElement(b.a,{className:"char-special"},d.a.createElement("div",{className:"char-special-item"},d.a.createElement("span",{className:"char-special-label"}),d.a.createElement("div",{className:"char-special-input total"},"Total"),d.a.createElement("div",{className:"char-special-input"},"+/-"),d.a.createElement("div",{className:"char-special-input"},"Base")),P.special.map((function(e){var t=e.label,l=e.full,n=e.field;return d.a.createElement("div",{key:t,className:"char-special-item"},d.a.createElement(g.a,{title:l},d.a.createElement("span",{className:"char-special-label"},t)),d.a.createElement(E.a.Item,{name:["special",n,"total"]},d.a.createElement(v.a,{className:"char-special-input total",readOnly:!0,min:0,max:9,disabled:!a})),d.a.createElement(E.a.Item,{name:["special",n,"change"]},d.a.createElement(N.a,{className:"char-special-input",min:0,max:9,disabled:!a})),d.a.createElement(E.a.Item,{name:["special",n,"base"]},d.a.createElement(N.a,{className:"char-special-input",min:0,max:9,disabled:!a})))})))},e.getSkills=function(){var a=e.props.hasRight;return d.a.createElement(b.a,{className:"char-skills"},d.a.createElement("div",{className:"char-skills-item"},d.a.createElement("span",{className:"char-skills-label"}),d.a.createElement("div",{className:"char-skills-input total"},"Total"),d.a.createElement("div",{className:"char-skills-input"},"+/-"),d.a.createElement("div",{className:"char-skills-input"},"Base")),P.skills.map((function(e){var t=e.label,l=e.full,n=e.formula,s=e.field;return d.a.createElement("div",{key:s,className:"char-skills-item"},d.a.createElement(g.a,{title:l},d.a.createElement("span",{className:"char-skills-label"},t)),d.a.createElement(E.a.Item,{name:["skills",s,"total"]},d.a.createElement(v.a,{className:"char-skills-input",readOnly:!0,disabled:!a})),d.a.createElement(E.a.Item,{name:["skills",s,"change"]},d.a.createElement(N.a,{className:"char-skills-input",disabled:!a,min:1,max:95})),d.a.createElement(g.a,{title:n},d.a.createElement(E.a.Item,{name:["skills",s,"base"]},d.a.createElement(v.a,{className:"char-skills-input",readOnly:!0,disabled:!a}))))})))},e.getStats=function(){var a=e.props.hasRight;return d.a.createElement(b.a,{className:"char-stats"},P.stats.map((function(e){var t=e.label,l=e.full,n=e.field,s=e.getBase;return d.a.createElement("div",{key:n,className:"char-stats-item"},d.a.createElement(g.a,{title:l},d.a.createElement("span",{className:"char-stats-label"},t)),d.a.createElement(E.a.Item,{name:["stats",n]},"wounds"===n?d.a.createElement(v.a.TextArea,{className:"char-stats-input",disabled:!a}):s?d.a.createElement(v.a,{className:"char-stats-input",readOnly:!0,disabled:!a}):d.a.createElement(N.a,{className:"char-stats-input",min:1,max:Number.MAX_SAFE_INTEGER,disabled:!a})))})))},e.getMainStats=function(){var a=e.props.hasRight;return d.a.createElement(b.a,{className:"char-main-stats"},d.a.createElement("div",{className:"char-main-stats-health"},d.a.createElement("div",{className:"char-main-stats-hp"},d.a.createElement("span",{className:"char-main-stats-hp-label"},"\u041e\u0447\u043a\u0438 \u0417\u0434\u043e\u0440\u043e\u0432\u044c\u044f (\u041e\u0417)"),d.a.createElement("div",{className:"char-main-stats-hp-body"},d.a.createElement(E.a.Item,{name:["stats","healthPoints"]},d.a.createElement(N.a,{max:e.state.stats.maxHealthPoints||void 0,min:-Math.floor(e.state.stats.maxHealthPoints/2),disabled:!a})),"/",d.a.createElement(E.a.Item,{name:["stats","maxHealthPoints"]},d.a.createElement(v.a,{readOnly:!0,disabled:!a})))),d.a.createElement("div",{className:"char-main-stats-ap-wrapper"},d.a.createElement("div",{className:"char-main-stats-ap"},d.a.createElement(g.a,{title:"\u041a\u043b\u0430\u0441\u0441 \u0411\u0440\u043e\u043d\u0438 (\u041a\u0411)"},d.a.createElement("div",{className:"char-main-stats-ap-total"},"\u041a\u0411")),d.a.createElement("div",{className:"char-main-stats-ap-change"},"+/-"),d.a.createElement("div",{className:"char-main-stats-ap-base"},"Base")),d.a.createElement("div",{className:"char-main-stats-ap"},d.a.createElement(E.a.Item,{name:["stats","armorClass","total"]},d.a.createElement(v.a,{className:"char-main-stats-ap-total",readOnly:!0,disabled:!a})),d.a.createElement(E.a.Item,{name:["stats","armorClass","change"]},d.a.createElement(N.a,{className:"char-main-stats-ap-change",min:1,max:95,disabled:!a})),d.a.createElement(E.a.Item,{name:["stats","armorClass","base"]},d.a.createElement(v.a,{className:"char-main-stats-ap-base",readOnly:!0,disabled:!a}))))),d.a.createElement("div",{className:"char-main-stats-info"},P.subStats.slice(3).map((function(e){var t=e.label,l=e.full,n=e.field;return d.a.createElement("div",{key:n,className:"char-main-stats-item"},d.a.createElement(g.a,{title:l},d.a.createElement("span",{className:"char-main-stats-item-label"},t)),d.a.createElement(E.a.Item,{name:["stats",n]},d.a.createElement(v.a,{className:"char-main-stats-item-input",readOnly:!0,disabled:!a})))}))))},e.onChange=function(){var a=Object(c.a)(i.a.mark((function a(t,l){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.bio){a.next=4;break}e.setState({bio:t.bio}),a.next=9;break;case 4:return a.t0=e,a.next=7,e.processChar(t,l);case 7:a.t1=a.sent,a.t0.setState.call(a.t0,a.t1);case 9:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}(),e.processChar=function(){var e=Object(c.a)(i.a.mark((function e(a,t){var l,r,c,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.special,r=t.skills,c=t.stats,u=t.bio,a.bio||(m={},P.special.forEach((function(e){var a=e.field,t=e.label,n=l[a],r=Math.max(0,Math.min(9,n.base+n.change));l[a]=Object(s.a)(Object(s.a)({},n),{},{total:r}),m[t.toLowerCase()]=r})),c.spentSkillPoints=0,P.skills.forEach((function(e){var a=e.field,t=e.getBase,l=r[a],n=Math.max(1,l.change),s=Math.max(1,t?t(m,c):1),i=Math.max(1,Math.min(95,s+n));r[a]={change:n,base:s,total:i},c.spentSkillPoints+=l.change-1})),[].concat(Object(n.a)(P.stats),Object(n.a)(P.subStats)).forEach((function(e){var a=e.field,t=e.getBase;if(t)if("armorClass"===a){var l=t(m,c),n=c[a].change;c[a]={change:n,base:l,total:n+l}}else c[a]=Math.floor(t(m,c))}))),e.abrupt("return",{special:l,skills:r,stats:c,bio:u});case 3:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}(),e.getChanges=function(e,a){var t=Object(O.diff)(a,e),n=Object(O.diff)(e,a),s=[];return Object.entries(t).forEach((function(e){var a=Object(l.a)(e,2),t=a[0],r=a[1];"bio"!==t||"string"!==typeof r?Object.entries(r).forEach((function(e){var a=Object(l.a)(e,2),r=a[0],i=a[1],c=n[t][r],u=Object(P.getConfigByField)(r);u&&s.push({label:u.label,full:u.full,before:i,after:c})})):s.push({label:"Bio",full:"\u0411\u0438\u043e\u0433\u0440\u0430\u0444\u0438\u044f",before:r,after:n[t]})})),s},e.onSave=function(){var a=e.props,t=a.uid,l=a.user,n=e.state;if(l){var r=e.getChanges(P.initialCharacter,n);0!==r.length&&0!==(r=e.getChanges(l.character||P.initialCharacter,n)).length?n.stats.skillPoints<0?k.a.error("\u041e\u0447\u043a\u0438 \u041d\u0430\u0432\u044b\u043a\u043e\u0432 (\u041e\u041d) \u043d\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438!"):(k.a.success("\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d"),G.default.setUser({uid:t,user:Object(s.a)(Object(s.a)({},l),{},{character:n})}),G.default.sendMessage({uid:t,message:"\u0425\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b",data:{characterChanges:r}})):k.a.error("\u0412 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c")}else k.a.error("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d!")},e.render=function(){var a=e.props,t=a.user,l=a.hasRight,n=a.currentUser,s=a.history;return t?t&&t.uid&&n&&n.uid===t.uid&&"/character"===s.location.pathname?d.a.createElement(h.a,{from:"/character",to:"/".concat(n.uid,"/character"),exact:!0}):d.a.createElement(E.a,{initialValues:t.character||P.initialCharacter,onValuesChange:e.onChange},d.a.createElement(b.a,{className:"char",title:d.a.createElement(d.a.Fragment,null,d.a.createElement(y.a,null)," ","\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u0438\u0433\u0440\u043e\u043a\u0430 ",t.nickname||t.uid),extra:d.a.createElement(C.a,{title:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",okText:"\u0414\u0430",cancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",onConfirm:e.onSave},d.a.createElement(S.a,null,"\u0413\u043e\u0442\u043e\u0432\u043e"))},d.a.createElement("div",{className:"char-bio"},d.a.createElement(v.a.TextArea,{disabled:!l,minLength:3,value:e.state.bio,onChange:function(a){return e.setState({bio:a.currentTarget.value})}})),d.a.createElement("div",null,e.getMainStats()),d.a.createElement("div",null,d.a.createElement("div",null,e.getSpecial(),e.getStats()),d.a.createElement("div",null,e.getSkills())))):d.a.createElement(B.a,{spinning:!0},d.a.createElement(x.a,{description:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d"}))},e}return t}(f.Component);a.default=Object(h.g)(Object(p.b)((function(e,a){var t=e.loading,l=e.users,n=e.currentUser,s=new URLSearchParams(a.match.params).get("uid")||e.uid||localStorage.getItem("uid")||"0",r=l[s];return r&&!r.uid&&s&&(r.uid=s),{loading:t,user:r,uid:s,hasRight:!!r&&!!n&&r.approved&&(n.uid===r.uid||!!n.isAdmin),currentUser:n}}))(M))},250:function(e,a,t){"use strict";t.r(a),t.d(a,"initialCharacteristic",(function(){return l})),t.d(a,"initialCharacter",(function(){return n})),t.d(a,"special",(function(){return s})),t.d(a,"skills",(function(){return r})),t.d(a,"stats",(function(){return i})),t.d(a,"subStats",(function(){return c})),t.d(a,"getConfigByField",(function(){return u}));var l={change:0,base:0,total:0},n={special:{strength:l,perception:l,endurance:l,charisma:l,intelligence:l,agility:l,luck:l},skills:{smallGuns:l,bigGuns:l,energyGuns:l,unarmed:l,meleeWeapons:l,medicine:l,sneak:l,lockpick:l,steal:l,traps:l,science:l,repair:l,speech:l,barter:l,survival:l},stats:{level:0,hpPerLevel:0,exp:0,carryWeight:0,wounds:"",maxHealthPoints:0,healthPoints:0,armorClass:l,healingRate:0,resistance:0,actionPoints:0,sequence:0,meleeDamage:0,criticalChance:0,skillPoints:0,spentSkillPoints:0},bio:""},s=[{label:"ST",full:"\u0421\u0438\u043b\u0430",field:"strength"},{label:"PE",full:"\u0412\u043e\u0441\u043f\u0440\u0438\u044f\u0442\u0438\u0435",field:"perception"},{label:"EN",full:"\u0412\u044b\u043d\u043e\u0441\u043b\u0438\u0432\u043e\u0441\u0442\u044c",field:"endurance"},{label:"CH",full:"\u0425\u0430\u0440\u0438\u0437\u043c\u0430",field:"charisma"},{label:"IN",full:"\u0418\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442",field:"intelligence"},{label:"AG",full:"\u041b\u043e\u0432\u043a\u043e\u0441\u0442\u044c",field:"agility"},{label:"LK",full:"\u0423\u0434\u0430\u0447\u0430",field:"luck"}],r=[{label:"Small Guns",full:"\u041e\u0440\u0443\u0436\u0438\u0435",formula:"5+(4*AG)",field:"smallGuns",getBase:function(e){return 5+4*e.ag}},{label:"Big Guns",full:"\u0411\u043e\u043b\u044c\u0448\u043e\u0435 \u043e\u0440\u0443\u0436\u0438\u0435",formula:"(2*AG)",field:"bigGuns",getBase:function(e){return 2*e.ag}},{label:"Energy Guns",full:"\u042d\u043d\u0435\u0440\u0433\u0435\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043e\u0440\u0443\u0436\u0438\u0435",formula:"(2*AG)",field:"energyGuns",getBase:function(e){return 2*e.ag}},{label:"Unarmed",full:"\u0411\u0435\u0437 \u043e\u0440\u0443\u0436\u0438\u044f",formula:"(30+(2*(AG+ST)))",field:"unarmed",getBase:function(e){return 30+2*(e.ag+e.st)}},{label:"Melee",full:"\u0425\u043e\u043b\u043e\u0434\u043d\u043e\u0435 \u043e\u0440\u0443\u0436\u0438\u0435",formula:"20+(2*(AG+ST))",field:"meleeWeapons",getBase:function(e){return 20+2*(e.ag+e.st)}},{label:"Medicine",full:"\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0430",formula:"5+(PE+EN+(3*AG))",field:"medicine",getBase:function(e){return 5+(e.pe+e.en+3*e.ag)}},{label:"Sneak",full:"\u0421\u043a\u0440\u044b\u0442\u043d\u043e\u0441\u0442\u044c",formula:"5+(3*AG)",field:"sneak",getBase:function(e){return 5+3*e.ag}},{label:"Lockpick",full:"\u0412\u0437\u043b\u043e\u043c",formula:"10+(PE+AG)",field:"lockpick",getBase:function(e){return 10+(e.pe+e.ag)}},{label:"Steal",full:"\u041a\u0440\u0430\u0436\u0430",formula:"(3+AG)",field:"steal",getBase:function(e){return 3+e.ag}},{label:"Traps",full:"\u041b\u043e\u0432\u0443\u0448\u043a\u0438",formula:"10+(PE+AG)",field:"traps",getBase:function(e){return 10+(e.pe+e.ag)}},{label:"Science",full:"\u041d\u0430\u0443\u043a\u0430",formula:"(4*IN)",field:"science",getBase:function(e){return 4*e.in}},{label:"Repair",full:"\u0420\u0435\u043c\u043e\u043d\u0442",formula:"(3*IN)",field:"repair",getBase:function(e){return 3*e.in}},{label:"Speech",full:"\u041a\u0440\u0430\u0441\u043d\u043e\u0440\u0435\u0447\u0438\u0435",formula:"(5*CH)",field:"speech",getBase:function(e){return 5*e.ch}},{label:"Barter",full:"\u0411\u0430\u0440\u0442\u0435\u0440",formula:"(4*CH)",field:"barter",getBase:function(e){return 4*e.ch}},{label:"Survival",full:"\u0412\u044b\u0436\u0438\u0432\u0430\u043d\u0438\u0435",formula:"(2*(EN+IN))",field:"survival",getBase:function(e){return 2*(e.en+e.in)}}],i=[{label:"Level",full:"\u0423\u0440\u043e\u0432\u0435\u043d\u044c",field:"level",getBase:function(e,a){return(Math.sqrt(a.exp/500*4+1)+1)/2}},{label:"HP/Level",full:"\u041e\u0417/\u0423\u0440\u043e\u0432\u0435\u043d\u044c",field:"hpPerLevel",getBase:function(e){return 3+Math.floor(e.en/2)}},{label:"Experience",full:"\u041e\u043f\u044b\u0442",field:"exp"},{label:"Carry Weight",full:"\u041f\u0435\u0440\u0435\u043d\u043e\u0441\u0438\u043c\u044b\u0439 \u0432\u0435\u0441",field:"carryWeight",getBase:function(e){return 25+25*e.st}},{label:"Wounds",full:"\u0420\u0430\u043d\u044b",field:"wounds"}],c=[{label:"Max HP",full:"\u041c\u0430\u043a\u0441. \u041e\u0447\u043a\u0438 \u0417\u0434\u043e\u0440\u043e\u0432\u044c\u044f (\u041e\u0417)",field:"maxHealthPoints",getBase:function(e,a){return 15+(e.st+2*e.en)+a.hpPerLevel*a.level}},{label:"Health Points",full:"\u041e\u0447\u043a\u0438 \u0417\u0434\u043e\u0440\u043e\u0432\u044c\u044f (\u041e\u0417)",field:"healthPoints"},{label:"\u041a\u0411",full:"\u041a\u043b\u0430\u0441\u0441 \u0411\u0440\u043e\u043d\u0438",field:"armorClass",getBase:function(e){return e.ag}},{label:"\u0421\u041b",full:"\u0421\u0430\u043c\u043e\u041b\u0435\u0447\u0435\u043d\u0438\u0435",field:"healingRate",getBase:function(e){return Math.floor(e.en/3)}},{label:"\u0421\u041f",full:"\u0421\u043e\u041f\u0440\u043e\u0442\u0438\u0432\u043b\u0435\u043d\u0438\u0435",field:"resistance",getBase:function(e){return 5*e.en}},{label:"\u041e\u0414",full:"\u041e\u0447\u043a\u0438 \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0439",field:"actionPoints",getBase:function(e){return 5+Math.ceil(e.ag/2)}},{label:"\u0418\u0426",full:"\u0418\u043d\u0438\u0426\u0438\u0430\u0442\u0438\u0432\u0430",field:"sequence",getBase:function(e){return 2*e.pe}},{label:"\u0420\u0423",full:"\u0420\u0443\u043a\u043e\u043f\u0430\u0448\u043d\u044b\u0439 \u0423\u0440\u043e\u043d",field:"meleeDamage",getBase:function(e){return Math.max(1,e.st-5)}},{label:"\u0428\u041a",full:"\u0428\u0430\u043d\u0441 \u041a\u0440\u0438\u0442\u0430",field:"criticalChance",getBase:function(e){return e.lk}},{label:"\u041e\u041d",full:"\u041e\u0447\u043a\u0438 \u041d\u0430\u0432\u044b\u043a\u043e\u0432",field:"skillPoints",getBase:function(e,a){return(a.level-1)*(5+2*e.in)-a.spentSkillPoints}}],u=function(e){return[].concat(s,r,i,c).find((function(a){return a.field===e}))}},443:function(e,a,t){}}]);
//# sourceMappingURL=11.a398fec2.chunk.js.map