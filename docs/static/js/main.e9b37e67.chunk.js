(this["webpackJsonptext-roleplay"]=this["webpackJsonptext-roleplay"]||[]).push([[0],{170:function(e){e.exports=JSON.parse('[{"label":"\u0427\u0430\u0442","path":"/text-roleplay/chat"},{"label":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438","path":"./settings"},{"label":"\u0412\u044b\u0439\u0442\u0438","path":"/text-roleplay/logout"}]')},193:function(e){e.exports=JSON.parse('{"apiKey":"AIzaSyC_NJqbSuXGDiD6hcQZdmtBZnaVZ40ggIY","authDomain":"text-roleplay.firebaseapp.com","databaseURL":"https://text-roleplay.firebaseio.com","projectId":"text-roleplay","storageBucket":"text-roleplay.appspot.com","messagingSenderId":"226797822488","appId":"1:226797822488:web:e717b14d3ccc42e700996d"}')},199:function(e,t,a){e.exports=a(380)},208:function(e,t,a){},210:function(e,t,a){},264:function(e,t,a){},302:function(e,t,a){},368:function(e,t,a){},369:function(e,t,a){},380:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(7),c=a.n(s),o=a(19),u=(a(208),a(64)),i=(a(209),a(384)),l=a(58),m=(a(210),a(170));var g=Object(o.b)((function(e){return{isLoggedIn:e.isLoggedIn}}))(Object(l.g)((function(e){if(!e.isLoggedIn)return r.a.createElement(r.a.Fragment,null);var t=window.innerWidth<767?"horizontal":"inline";return r.a.createElement(i.a,{mode:t,selectedKeys:[e.location.pathname.split("/").pop()||""]},m.map((function(t){return r.a.createElement(i.a.Item,{key:t.path.split("/").pop(),disabled:t.path===e.location.pathname},r.a.createElement(u.b,{to:t.path},t.label))})))}))),d=a(51),p=a(55),f=a(52),b=a(390),v=a(388),E=a(382),S=a(387),h=(a(264),a(38)),O=a(8),j=a(48),y=a(195),w=a(174),x=a(88),I=a(113),C=a(112),_=/([1-9]|10)[d\u0434\u1C81]((10|12|20)|[468])/im,A=/([1-9]|10)[d\u0434\u1C81]((10|12|20)|[468])/gim,M=function(e,t){return new Array(e).fill(e+t).map((function(){return e=1,a=t,Math.floor(Math.random()*(a+1-e)+e);var e,a}))},k=function(e){if(!e)return"#000";for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",r=0;r<3;r++){n+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return n},U=function(e){return!!e&&(e||parseInt(localStorage.getItem("lastActivity")||"0"))+18e4>(new Date).getTime()},L=function(e){return 1==="".concat(e).length?"0".concat(e):e},T=function(e){var t=new Date(e);return[t.getHours(),t.getMinutes(),t.getSeconds()].map(L).join(":")},D=function(e){var t=new Date(e);return[t.getDate(),t.getMonth()+1,t.getFullYear()].map(L).join(".")},N=function(e){var t=new Date(e);return[[t.getHours(),t.getMinutes(),t.getSeconds()].map(L).join(":"),[t.getDate(),t.getMonth()+1,t.getFullYear()].map(L).join(".")].join(" ")},F=function(e){return/[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/gim.test(e)},G=function(e){return e.filter((function(e,t,a){return a.findIndex((function(t){return t.time===e.time}))===t})).sort((function(e,t){return t.time-e.time})).map((function(e,t,a){return t<a.length-2&&e.author===a[t+1].author?Object(O.a)(Object(O.a)({},e),{},{grouped:!0}):e}))},R=function(e){var t=e.body;return _.test(t)&&(e.rolls=function(e){var t=e.match(A);return t?t.map((function(e){var t=e.split(/[d\u0434]/),a=Object(I.a)(t,2),n=a[0],r=a[1],s=parseInt(n),c=parseInt(r),o=M(s,c);return{maxResult:c*s,minResult:s,sum:o.reduce((function(e,t){return e+t}),0),roll:e,results:o,amount:s,size:c}})):[]}(t)),/\*/.test(t)&&(e.isRP=!0),/(@[a-z\u017F\u0430-\u044F\u0451\u1C80-\u1C86\u212A]*)/im.test(t)&&(e.mentioned=!0),e},P=function(e){if(!e)return v.a.error("\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e\u0435"),!1;if(/[0-9]+[d\u0434\u1C81][0-9]+/im.test(e)){var t=e.match(/(( |^)[a-z\u017F\u0430-\u044F\u1C80-\u1C86\u212A]+[0-9]+[d\u0434\u1C81][0-9]+)|([0-9]+[d\u0434\u1C81][0-9]+[a-z\u017F\u0430-\u044F\u1C80-\u1C86\u212A]+( |$))|([0-9]+[d\u0434\u1C81][0-9]+)/gim);if(t)if(t.some((function(e){if(console.log(e),/(([a-z\u017F\u0430-\u044F\u0451\u1C80-\u1C86\u212A])[0-9]+[d\u0434\u1C81][0-9]+)|([0-9]+[d\u0434\u1C81][0-9]+([a-z\u017F\u0430-\u044F\u0451\u1C80-\u1C86\u212A]))/gim.test(e))return v.a.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432 \u0434\u0430\u0439\u0441\u0435 ".concat(e,". \u0420\u044f\u0434\u043e\u043c \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432")),!0;var t=e.split(/[d\u0434]/),a=Object(I.a)(t,2),n=a[0],r=a[1];return console.log(n,r,parseInt(n)>10,!/((10|12|20)|[468])/g.test(r)),parseInt(n)>10?(v.a.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432 \u0434\u0430\u0439\u0441\u0435 ".concat(e,". \u041d\u0435\u043b\u044c\u0437\u044f \u0431\u0440\u043e\u0441\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 10-\u0442\u0438 \u0434\u0430\u0439\u0441\u043e\u0432")),!0):-1===[2,4,6,8,10,12,20].indexOf(parseInt(r))&&(v.a.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432 \u0434\u0430\u0439\u0441\u0435 ".concat(e,". \u041c\u043e\u0436\u043d\u043e \u0431\u0440\u043e\u0441\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u0430\u0439\u0441\u044b \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u0432 4 6 8 10 12 20")),!0)})))return!1}return!0},z=JSON.parse(localStorage.getItem("user")||"null");z&&localStorage.setItem("uid",z.uid);var B={userData:z,isLoggedIn:null!==z,settings:!1,loading:!1,messages:[],users:{},uid:z?z.uid:""},J={lastOnline:0,nickname:"",avatar:"",uid:""},K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":case"GET_MESSAGES":case"GET_MORE_MESSAGES":case"SEND_MESSAGE":case"SET_USER":case"UPLOAD_FILE":return Object(O.a)(Object(O.a)({},e),{},{loading:!0});case"LOGIN_FAIL":case"SET_USER_SUCCESS":case"SET_USER_FAIL":case"GET_MESSAGES_FAIL":case"GET_MORE_MESSAGES_SUCCESS":case"GET_MORE_MESSAGES_FAIL":case"SEND_MESSAGE_FAIL":return Object(O.a)(Object(O.a)({},e),{},{loading:!1});case"LOGIN_SUCCESS":return Object(O.a)(Object(O.a)({},e),{},{uid:t.user.uid,userData:t.user,isLoggedIn:null!==t.user});case"LOGOUT":return Object(O.a)(Object(O.a)({},e),{},{userData:null,isLoggedIn:!1});case"GET_MESSAGES_SUCCESS":var a=t.concat?[].concat(Object(x.a)(e.messages),Object(x.a)(t.messages)):t.messages;return Object(O.a)(Object(O.a)({},e),{},{messages:G(a),loading:!1});case"GET_USER_SUCCESS":return Object(O.a)(Object(O.a)({},e),{},{users:Object(O.a)(Object(O.a)({},e.users),{},Object(h.a)({},t.uid,t.user))});default:return e}},W=Object(y.a)(),Z=Object(j.createStore)(K,B,Object(w.composeWithDevTools)(Object(j.applyMiddleware)(W))),q=Z.dispatch,H=function(e){return function(t){return q(Object(O.a)({type:e},t))}},Y=function(e){var t,a=e.toLowerCase().replace(/_./g,(function(e){return e.toUpperCase()})).replace(/_/g,"");return t={},Object(h.a)(t,a,H(e)),Object(h.a)(t,"".concat(a,"Success"),H("".concat(e,"_SUCCESS"))),Object(h.a)(t,"".concat(a,"Fail"),H("".concat(e,"_FAIL"))),t},V=Object(O.a)(Object(O.a)(Object(O.a)(Object(O.a)(Object(O.a)(Object(O.a)(Object(O.a)(Object(O.a)(Object(O.a)(Object(O.a)({},Y("LOGIN")),Y("GET_USER")),Y("GET_MESSAGES")),Y("GET_MORE_MESSAGES")),Y("SET_USER")),Y("SEND_MESSAGE")),Y("SUBSCRIBE")),Y("UNSUBSCRIBE")),Y("UPLOAD_FILE")),{},{updateLastOnline:H("UPDATE_LAST_ONLINE"),logout:H("LOGOUT")}),X=a(385),$=a(197),Q=a(381),ee=function(e){var t=e.avatar,a=e.nickname,n=e.style,s=Object($.a)(e,["avatar","nickname","style"]),c=F(t)?t:"";return r.a.createElement(Q.a,Object.assign({src:c,style:Object(O.a)(Object(O.a)({},n),{},{backgroundColor:c?"transparent":k(a)})},s),a)},te=a(177),ae=a(386),ne=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={visible:!1},e.showModal=function(){e.setState({visible:!e.state.visible})},e}return Object(te.a)(a,[{key:"render",value:function(){var e=this.props.src;return r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{onClick:this.showModal,src:e,alt:"",className:"chat-image"}),r.a.createElement(ae.a,{title:r.a.createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer"},e),closable:!0,footer:null,visible:this.state.visible,onCancel:this.showModal,width:"fit-content"},r.a.createElement("img",{style:{maxWidth:"90vw"},src:e,alt:""})))}}]),a}(n.Component),re=function(e){var t=e.message,a=t.body,n=t.isRP,s=t.rolls;if(F(a)){if(/\.(gif|jpe?g|tiff|png|webp|bmp)/gi.test(a))return r.a.createElement(ne,{src:a});if(/youtu/.test(a)){var c=new URL(a).searchParams.get("v")||"";return r.a.createElement("iframe",{title:c,id:"ytplayer",width:"100%",height:"360",src:"http://www.youtube.com/embed/".concat(c),frameBorder:"0"})}return r.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},a)}var o=s?function(e,t){var a=Object(x.a)(t);return e.split(" ").map((function(e,t){var n=a.findIndex((function(t){return t.roll===e}));if(n>-1){var s=a.splice(n,1)[0],c=s.results,o=s.maxResult,u=s.minResult,i=s.sum,l="".concat(i," = ").concat(c.join(" + ")),m=(i===o?"critHit":i===u&&"critMiss")||"";return r.a.createElement(r.a.Fragment,{key:e+t}," ",r.a.createElement(C.a,{title:l},r.a.createElement("b",{className:m},e,"(",i,")")))}return" ".concat(e)}))}(a,s):a;return n?r.a.createElement("i",{className:"rp-message"},o):r.a.createElement("span",null,o)},se=function(e){var t=e.message,a=t.time,n=t.grouped,s=t.body,c=t.mentioned,o=e.user,i=o&&r.a.createElement(u.b,{to:"./".concat(o.uid,"/settings")},r.a.createElement(C.a,{title:o.lastOnline?"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c: ".concat(N(o.lastOnline)):void 0,placement:"left"},r.a.createElement("div",{className:"chat-message__title ".concat(U(o.lastOnline)?"online":"")},r.a.createElement(ee,{avatar:o.avatar,nickname:o.nickname}),r.a.createElement("div",{className:"chat-message__nickname"},o.nickname||o.uid))));return r.a.createElement(X.a,{className:"chat-message ".concat(n?"grouped":""," ").concat(c&&o&&s.indexOf("@".concat(o.nickname," "))>-1?"mentioned":""),title:i,key:a,extra:r.a.createElement(C.a,{title:D(a)},r.a.createElement("div",{className:"chat-time"},T(a)))},r.a.createElement(re,{message:e.message}))},ce=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={message:"",sending:!1},e.componentDidMount=function(){V.getMessages({}),V.subscribe({}),e.setState({message:localStorage.getItem("message")||""})},e.componentWillUnmount=function(){V.unsubscribe({})},e.componentDidUpdate=function(t){var a=e.props,n=a.messages,r=a.users;e.state.sending&&t.messages!==n&&(localStorage.setItem("message",""),e.setState({message:"",sending:!1})),n.forEach((function(e){r[e.author]||V.getUser({uid:e.author})}))},e.onChangeMessage=function(t){var a=t.target.value;localStorage.setItem("message",a),e.setState({message:a})},e.onKeyDown=function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.onSendMessage());var a=e.props.uid;if("Up"===t.key||"ArrowUp"===t.key){var n=e.props.messages.find((function(e){return e.author===a}));if(n){var r=t.currentTarget,s=r.value,c=r.selectionStart;if(1===s.substr(0,c).split("\n").length){var o=n.body;localStorage.setItem("message",o),e.setState({message:o})}}}},e.onSendMessage=function(){var t=e.state.message,a=e.props,n=a.user,r=a.loading,s=a.uid;r||(n?n.nickname?P(t)&&(e.setState({sending:!0}),V.sendMessage({uid:s,message:t})):v.a.error("\u041d\u0438\u043a\u043d\u0435\u0439\u043c \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d. \u041f\u0440\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0438 \u043d\u0430\u0437\u043e\u0432\u0438\u0442\u0435 \u0441\u0435\u0431\u044f"):v.a.error("\u0414\u0430\u043d\u043d\u044b\u0435 \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442"))},e.getMoreMessages=function(){V.getMoreMessages({firstMessage:e.props.messages[e.props.messages.length-1]})},e.onScroll=function(t){t.currentTarget.scrollTop<=50&&(t.preventDefault(),e.getMoreMessages())},e.uploadFile=function(t,a){var n=e.props.uid;t&&(t.type.indexOf("image")>-1?V.uploadFile({uid:n,file:t}):v.a.error("\u0422\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b"),a.preventDefault())},e.onPaste=function(t){e.uploadFile(t.clipboardData.files[0],t)},e.onDrop=function(t){var a=t.dataTransfer.items[0].getAsFile();a&&e.uploadFile(a,t)},e.render=function(){var t=e.props,a=t.messages,n=t.loading,s=t.users;return r.a.createElement(E.a,{spinning:n},r.a.createElement("div",{className:"chat-wrapper"},r.a.createElement("div",{className:"chat-body",onScroll:e.onScroll},a.map((function(e){return r.a.createElement(se,{key:e.time,message:e,user:s[e.author]})}))),r.a.createElement("div",{className:"chat-controls"},r.a.createElement(S.a.TextArea,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",autoSize:{minRows:1,maxRows:10},onChange:e.onChangeMessage,onKeyDown:e.onKeyDown,value:e.state.message,onPaste:e.onPaste,onDrop:e.onDrop}),r.a.createElement(b.a,{onClick:e.onSendMessage}))))},e}return a}(n.Component),oe=Object(o.b)((function(e){var t=e.messages,a=e.uid,n=e.loading,r=e.users;return{messages:t,uid:a,loading:n,users:r,user:r[a]}}))(ce),ue=a(389),ie=a(30),le=a(393),me=a(391),ge=a(392),de=function(e){var t=e.loading;return r.a.createElement("div",{className:"loader"},t?r.a.createElement(me.a,{spin:!0,style:{color:"#ff4d4f"}}):r.a.createElement(ge.a,{twoToneColor:"#52c41a"}))},pe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).componentDidMount=function(){var t=e.props.user;t&&V.getUser({uid:t.uid})},e.onChange=function(t){return function(a){var n=e.props.user;if(n){var r=Object(O.a)(Object(O.a)({},n),{},Object(h.a)({},t,a.target.value));e.setSettings(r)}}},e.setSettings=function(t){var a=e.props.user;a&&V.setUser({uid:a.uid,user:t})},e.clearAvatar=function(){return e.setSettings(Object(O.a)(Object(O.a)({},e.props.user),{},{avatar:""}))},e.getField=function(t,a,n){var s=n.nickname,c=void 0===s?"":s;switch(t){case"avatar":return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(S.a,{value:a,onChange:e.onChange(t)}),r.a.createElement(ue.a,{title:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440?",onConfirm:e.clearAvatar,okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442",icon:r.a.createElement(le.a,{style:{color:"#ff4d4f"}}),disabled:!a},r.a.createElement(ie.a,{disabled:!a,danger:!0},r.a.createElement(le.a,null)))),r.a.createElement(ee,{avatar:a,nickname:c,size:128,style:{margin:"8px auto",display:"block"}}));case"uid":return r.a.createElement(S.a,{value:a,readOnly:!0});case"lastOnline":return r.a.createElement(S.a,{value:N(parseInt(a)),readOnly:!0});default:return r.a.createElement(S.a,{defaultValue:a,onChange:e.onChange(t)})}},e.labels={avatar:"\u0410\u0432\u0430\u0442\u0430\u0440",nickname:"\u041d\u0438\u043a\u043d\u0435\u0439\u043c",lastOnline:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c",uid:"UID"},e.render=function(){var t=e.props,a=t.user,n=t.loading;return console.log("user",a),r.a.createElement(X.a,{className:"settings",bordered:!1,loading:void 0===a},r.a.createElement(de,{loading:n}),a&&Object.keys(J).map((function(t){var n=e.getField(t,"".concat(a[t]||""),a);return n&&r.a.createElement(X.a,{className:t,key:t,title:e.labels[t]},n)})))},e}return a}(r.a.Component),fe=Object(o.b)((function(e,t){var a=e.loading,n=e.users,r=new URLSearchParams(t.match.params).get("uid")||e.uid||"0",s=n[r];return s&&!s.uid&&r&&(s.uid=r),{loading:a,user:s}}))(pe),be=Object(o.b)()((function(){return r.a.createElement(X.a,null,r.a.createElement(Q.a,{src:"https://cdn.lowgif.com/full/fc3d7d9abd06a92e-hi-bear-gifs-get-the-best-gif-on-giphy.gif",size:256,style:{margin:"0 auto",display:"block"}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(ie.a,{type:"primary",size:"large",onClick:function(){return V.logout({})},style:{width:"100%"}},"\u0412\u044b\u0439\u0442\u0438"))})),ve=(a(302),function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).componentDidMount=function(){var t=e.props.user;t&&V.getUser({uid:t.uid})},e.render=function(){var t=e.props.loading;return r.a.createElement(X.a,{className:"inventory"},r.a.createElement(de,{loading:t}),r.a.createElement("div",{className:"inventory-body"}))},e}return a}(r.a.Component)),Ee=Object(o.b)((function(e,t){var a=e.loading,n=e.users,r=new URLSearchParams(t.match.params).get("uid")||e.uid||"0";return{loading:a,user:n[r]||Object(O.a)(Object(O.a)({},J),{},{uid:r})}}))(ve),Se=[{path:"/text-roleplay/chat",component:oe},{path:"/text-roleplay/:uid/settings",component:fe,exact:!0},{path:"/text-roleplay/settings",component:fe,exact:!0},{path:"/text-roleplay/:uid/inventory",component:Ee,exact:!0},{path:"/text-roleplay/inventory",component:Ee,exact:!0},{path:"/text-roleplay/logout",component:be}],he=a(383),Oe=Object(o.b)()((function(){return r.a.createElement(he.a,{onFinish:function(e){return V.login(e)}},r.a.createElement(he.a.Item,{label:"Email",name:"email",rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 e-mail!"}]},r.a.createElement(S.a,null)),r.a.createElement(he.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c!"}]},r.a.createElement(S.a.Password,null)),r.a.createElement(he.a.Item,null,r.a.createElement(ie.a,{type:"primary",htmlType:"submit"},"\u0412\u043e\u0439\u0442\u0438")))}));var je=Object(o.b)((function(e){return{isLoggedIn:e.isLoggedIn}}))((function(e){return e.isLoggedIn?r.a.createElement(l.d,null,Se.map((function(e){return r.a.createElement(l.b,{key:e.path,path:e.path,component:e.component,exact:e.exact||!1})})),r.a.createElement(l.a,{to:"/text-roleplay/chat"})):r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"*",component:Oe}))}));a(368),a(369);var ye=function(){return function(){var e=function(){U(parseInt(localStorage.getItem("lastActivity")||"0")-6e4)||V.updateLastOnline({})};["mousedown","mousemove","keydown","scroll","touchstart"].forEach((function(t){document.addEventListener(t,e,!0)})),e()}(),r.a.createElement(u.a,null,r.a.createElement(g,null),r.a.createElement("div",{className:"app"},r.a.createElement(je,null)))},we=a(18),xe=a.n(we),Ie=a(29),Ce=a(115),_e=a(193),Ae=(Object(Ce.initializeApp)(_e),Object(Ce.auth)()),Me=Object(Ce.database)();Ae.onAuthStateChanged((function(e){e?(V.loginSuccess({user:e}),V.getUser({uid:e.uid})):V.logout({})}));var ke=xe.a.mark(Re),Ue=xe.a.mark(Pe),Le=xe.a.mark(ze),Te=xe.a.mark(Be),De=xe.a.mark(We),Ne=xe.a.mark(Ze),Fe=xe.a.mark(Ye),Ge=xe.a.mark(Xe);function Re(e){var t,a,n,r;return xe.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.email,a=e.password,s.prev=1,s.next=4,Ae.signInWithEmailAndPassword(t,a);case 4:n=s.sent,V.loginSuccess({user:n}),localStorage.setItem("user",JSON.stringify(n.user)),localStorage.setItem("uid",n.user.uid),s.next=23;break;case 10:if(s.prev=10,s.t0=s.catch(1),console.error(s.t0),"auth/user-not-found"!==s.t0.code){s.next=22;break}return s.next=16,Ae.createUserWithEmailAndPassword(t,a);case 16:r=s.sent,V.loginSuccess({user:r}),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("uid",r.uid),s.next=23;break;case 22:V.loginFail({error:s.t0});case 23:case"end":return s.stop()}}),ke,null,[[1,10]])}function Pe(){return xe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.removeItem("user"),localStorage.removeItem("uid"),localStorage.removeItem("loggedIn"),e.next=5,Ae.signOut();case 5:case"end":return e.stop()}}),Ue)}function ze(e){var t,a;return xe.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.uid,a=e.user,n.prev=1,n.next=4,Me.ref("users").child(t).set(Object(O.a)(Object(O.a)({},a),{},{lastOnline:(new Date).getTime(),uid:t}));case 4:V.setUserSuccess({}),V.getUser({uid:t}),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error(n.t0),V.setUserSuccess({error:n.t0});case 12:case"end":return n.stop()}}),Le,null,[[1,8]])}function Be(e){var t,a,n;return xe.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.uid,a=e.message,n=(new Date).getTime(),r.prev=2,r.next=5,Me.ref("messages").child("".concat(n)).set(R({time:n,author:t,body:"".concat(a," ")}));case 5:localStorage.setItem("message",""),V.sendMessageSuccess({}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(2),console.error(r.t0),V.sendMessageFail({error:r.t0});case 13:case"end":return r.stop()}}),Te,null,[[2,9]])}function Je(){Me.ref("messages").orderByKey().limitToLast(1).on("value",(function(e){var t=Object.values(e.val()||{});V.getMessagesSuccess({messages:t,concat:!0})}))}function Ke(){Me.ref("messages").off()}function We(){var e,t;return xe.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Me.ref("messages").orderByKey().limitToLast(30).once("value");case 2:e=a.sent,t=Object.values(e.val()||{}),V.getMessagesSuccess({messages:t});case 5:case"end":return a.stop()}}),De)}function Ze(e){var t,a,n;return xe.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.firstMessage,r.next=3,Me.ref("messages").orderByKey().endAt("".concat(t.time)).limitToLast(30).once("value");case 3:a=r.sent,n=Object.values(a.val()||{}),V.getMessagesSuccess({messages:n,concat:!0});case 6:case"end":return r.stop()}}),Ne)}var qe={};function He(e){var t=e.uid;qe[t]||(qe[t]=!0,Me.ref("users").child(t).on("value",(function(e){var a=e.val()||{};V.getUserSuccess({user:a,uid:t})})))}function Ye(){var e,t;return xe.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if((e=localStorage.getItem("uid"))&&"undefined"!==e){a.next=3;break}return a.abrupt("return");case 3:return t=(new Date).getTime(),localStorage.setItem("lastActivity","".concat(t)),a.next=7,Me.ref("users").child("".concat(e)).child("lastOnline").set(t);case 7:case"end":return a.stop()}}),Fe)}function Ve(e){var t=e.file,a=e.uid,n=new XMLHttpRequest,r=new FormData;r.append("image",t),n.open("POST","https://api.imgur.com/3/image/"),n.setRequestHeader("Authorization","Client-ID ea2c833b74d4583"),n.onreadystatechange=function(){if(200===n.status&&4===n.readyState){var e=JSON.parse(n.responseText);V.sendMessage({uid:a,message:e.data.link})}},n.send(r)}function Xe(){return xe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ie.a)("LOGIN",Re);case 2:return e.next=4,Object(Ie.a)("LOGOUT",Pe);case 4:return e.next=6,Object(Ie.a)("GET_USER",He);case 6:return e.next=8,Object(Ie.a)("SET_USER",ze);case 8:return e.next=10,Object(Ie.a)("SEND_MESSAGE",Be);case 10:return e.next=12,Object(Ie.a)("GET_MESSAGES",We);case 12:return e.next=14,Object(Ie.a)("GET_MORE_MESSAGES",Ze);case 14:return e.next=16,Object(Ie.a)("SUBSCRIBE",Je);case 16:return e.next=18,Object(Ie.a)("UPDATE_LAST_ONLINE",Ye);case 18:return e.next=20,Object(Ie.a)("UNSUBSCRIBE",Ke);case 20:return e.next=22,Object(Ie.a)("UPLOAD_FILE",Ve);case 22:case"end":return e.stop()}}),Ge)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));W.run(Xe),c.a.render(r.a.createElement(o.a,{store:Z},r.a.createElement(ye,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[199,1,2]]]);
//# sourceMappingURL=main.e9b37e67.chunk.js.map