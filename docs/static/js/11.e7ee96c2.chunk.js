(this["webpackJsonptext-roleplay"]=this["webpackJsonptext-roleplay"]||[]).push([[11,39],{158:function(e,a,t){"use strict";t.r(a);var c=t(6),r=t.n(c),n=t(182),s=t(2),l=t(20),i=t(49),m=t(51),o=t(50),h=t(0),u=t.n(h),d=t(27),p=t(37),v=t(447),g=t(150),f=t(72),b=t(487),E=t(101),N=t(479),O=t(34),C=t(63),k=t(519),x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888.3 757.4h-53.8c-4.2 0-7.7 3.5-7.7 7.7v61.8H197.1V197.1h629.8v61.8c0 4.2 3.5 7.7 7.7 7.7h53.8c4.2 0 7.7-3.4 7.7-7.7V158.7c0-17-13.7-30.7-30.7-30.7H158.7c-17 0-30.7 13.7-30.7 30.7v706.6c0 17 13.7 30.7 30.7 30.7h706.6c17 0 30.7-13.7 30.7-30.7V765.1c0-4.3-3.5-7.7-7.7-7.7zm18.6-251.7L765 393.7c-5.3-4.2-13-.4-13 6.3v76H438c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h314v76c0 6.7 7.8 10.5 13 6.3l141.9-112a8 8 0 000-12.6z"}}]},name:"export",theme:"outlined"},j=t(14),S=function(e,a){return h.createElement(j.a,Object.assign({},e,{ref:a,icon:x}))};S.displayName="ExportOutlined";var y=h.forwardRef(S),w=t(511),T=t(512),R=t(460),M=(t(469),t(28)),B=t(4),H=t(23),U=function(e){Object(m.a)(t,e);var a=Object(o.a)(t);function t(){var e;Object(i.a)(this,t);for(var c=arguments.length,m=new Array(c),o=0;o<c;o++)m[o]=arguments[o];return(e=a.call.apply(a,[this].concat(m))).state={character:Object(M.getInitialCharacter)(),update:!1},e.componentDidMount=function(){var a=e.props,t=a.character,c=a.uid,r=a.user,n=a.currentUser,s=a.history;t?e.setState({character:t}):B.default.getCharacter({uid:c}),r||B.default.getUser({uid:c}),Object(H.redirectToUserPage)(r,n,s);var l=JSON.parse(localStorage.getItem("character-state")||"null");l&&e.setState(l)},e.saveState=function(){return localStorage.setItem("character-state",JSON.stringify(e.state))},e.componentDidUpdate=function(a){var t=e.props,c=t.character,r=t.user,n=t.currentUser,s=t.history;a.character!==c&&e.setState({character:c},e.saveState),Object(H.redirectToUserPage)(r,n,s)},e.componentWillUnmount=function(){e.saveState()},e.getSpecial=function(a){var t=e.props.hasRight,c=a.special,r=a.stats;return c&&u.a.createElement(v.a,{className:"char-special"},u.a.createElement("div",{className:"char-special-item"},u.a.createElement("span",{className:"char-special-label"}),u.a.createElement("div",{className:"char-special-input total"},"Total"),u.a.createElement("div",{className:"char-special-input"},"+/-"),u.a.createElement("div",{className:"char-special-input"},"Base")),M.special.map((function(a){var n=a.label,s=a.full,l=a.field;return u.a.createElement("div",{key:n,className:"char-special-item"},u.a.createElement(g.a,{title:s},u.a.createElement("span",{className:"char-special-label"},n)),u.a.createElement(f.a,{className:"char-special-input total",readOnly:!0,min:0,max:9,disabled:!t,value:c[l].total}),u.a.createElement(b.a,{className:"char-special-input",min:0,max:9,disabled:!t,value:c[l].change,onChange:e.onChange(["special",l,"change"])}),r.level>1?u.a.createElement(f.a,{className:"char-special-input",value:c[l].base,readOnly:!0}):u.a.createElement(b.a,{className:"char-special-input",min:0,max:9,disabled:!t,value:c[l].base,onChange:e.onChange(["special",l,"base"])}))})))},e.onGiftSelect=function(a){var t=e.props.hasRight,c=e.state.character;if(t){var r=Object(l.a)(c.gifts),n=r.indexOf(a);if(n>-1)r.splice(n,1);else{if(!(r.length<=2))return;r.push(a)}e.setState({character:Object(s.a)(Object(s.a)(Object(s.a)({},c),Object(H.processCharacterChanges)({},Object(s.a)(Object(s.a)({},c),{},{gifts:r}))),{},{gifts:r})})}},e.getSkills=function(a){var t=e.props.hasRight,c=a.skills,r=a.gifts,n=a.stats.level<=1;return c&&u.a.createElement(v.a,{className:"char-skills"},u.a.createElement("div",{className:"char-skills-item"},u.a.createElement("span",{className:"char-skills-label"}),u.a.createElement("div",{className:"char-skills-input total"},"Total"),u.a.createElement("div",{className:"char-skills-input"},"+/-"),u.a.createElement("div",{className:"char-skills-input"},"Base")),M.skills.map((function(a){var s=a.label,l=a.full,i=a.formula,m=a.field;return u.a.createElement("div",{key:m,className:"char-skills-item ".concat(n?"":"not-interactive")},u.a.createElement(g.a,{title:l,placement:"left"},u.a.createElement("span",{className:"char-skills-label ".concat(r.indexOf(m)>-1?"gift":""),onClick:function(){return n&&e.onGiftSelect(m)}},s)),u.a.createElement(f.a,{className:"char-skills-input",readOnly:!0,disabled:!t,value:c[m].total}),u.a.createElement(b.a,{className:"char-skills-input",disabled:!t,min:0,max:95,value:c[m].change,onChange:e.onChange(["skills",m,"change"])}),u.a.createElement(g.a,{title:i},u.a.createElement(f.a,{className:"char-skills-input",readOnly:!0,disabled:!t,value:c[m].base,onChange:e.onChange(["skills",m,"base"])})))})))},e.getStats=function(a){var t=e.props.hasRight,c=a.stats;return c&&u.a.createElement(v.a,{className:"char-stats"},M.stats.map((function(a){var r=a.label,n=a.full,s=a.field,l=a.getBase;return u.a.createElement("div",{key:s,className:"char-stats-item"},u.a.createElement(g.a,{title:n},u.a.createElement("span",{className:"char-stats-label"},r)),"wounds"===s?u.a.createElement(f.a.TextArea,{className:"char-stats-input",disabled:!t,value:c[s],onChange:e.onChange(["stats",s])}):l?u.a.createElement(f.a,{className:"char-stats-input",readOnly:!0,disabled:!t,value:c[s]}):u.a.createElement(b.a,{className:"char-stats-input",min:0,disabled:!t,value:c[s],onChange:e.onChange(["stats",s])}))})))},e.getMainStats=function(a){var t=e.props.hasRight,c=a.stats;return c&&u.a.createElement(v.a,{className:"char-main-stats"},u.a.createElement("div",{className:"char-main-stats-health"},u.a.createElement("div",{className:"char-main-stats-hp"},u.a.createElement("span",{className:"char-main-stats-hp-label"},"\u041e\u0447\u043a\u0438 \u0417\u0434\u043e\u0440\u043e\u0432\u044c\u044f (\u041e\u0417)"),u.a.createElement("div",{className:"char-main-stats-hp-body"},u.a.createElement(b.a,{max:c.maxHealthPoints||1e3,min:-Math.floor(c.maxHealthPoints/2),disabled:!t,value:c.healthPoints,onChange:e.onChange("stats.healthPoints")}),"/",u.a.createElement(f.a,{value:c.maxHealthPoints,readOnly:!0,disabled:!t}))),u.a.createElement("div",{className:"char-main-stats-ap-wrapper"},u.a.createElement("div",{className:"char-main-stats-ap"},u.a.createElement(g.a,{title:"\u041a\u043b\u0430\u0441\u0441 \u0411\u0440\u043e\u043d\u0438 (\u041a\u0411)"},u.a.createElement("div",{className:"char-main-stats-ap-total"},"\u041a\u0411")),u.a.createElement("div",{className:"char-main-stats-ap-change"},"+/-"),u.a.createElement("div",{className:"char-main-stats-ap-base"},"Base")),u.a.createElement("div",{className:"char-main-stats-ap"},u.a.createElement(f.a,{className:"char-main-stats-ap-total",min:0,max:95,readOnly:!0,disabled:!t,value:Math.min(95,c.armorClass.total)}),u.a.createElement(b.a,{className:"char-main-stats-ap-change",min:1,max:95,disabled:!t,value:c.armorClass.change,onChange:e.onChange("stats.armorClass.change")}),u.a.createElement(f.a,{className:"char-main-stats-ap-base",readOnly:!0,disabled:!t,value:c.armorClass.base})))),u.a.createElement("div",{className:"char-main-stats-info"},M.subStats.slice(3).map((function(e){var a=e.label,r=e.full,n=e.field;return u.a.createElement("div",{key:n,className:"char-main-stats-item"},u.a.createElement(g.a,{title:r},u.a.createElement("span",{className:"char-main-stats-item-label"},a)),u.a.createElement(f.a,{className:"char-main-stats-item-input",readOnly:!0,disabled:!t,value:c[n]}))}))))},e.onChange=function(a){return function(t){if(void 0!==t&&("number"===typeof t||t.target)){var c="number"===typeof t?t:t.target.value||"",r="number"===typeof c?Math.min(464999,c):c||"",n=Object(H.set)(e.state.character,a,r),l=Object(H.processCharacterChanges)({},n);e.setState({character:Object(s.a)(Object(s.a)({},e.state.character),l)})}}},e.onSave=Object(n.a)(r.a.mark((function a(){var t,c,n,s,l,i,m=arguments;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=m.length>0&&void 0!==m[0]&&m[0],c=e.props,n=c.uid,s=c.character,l=e.state.character,s){a.next=6;break}return t&&E.a.error("\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d!"),a.abrupt("return");case 6:if(0!==(i=Object(H.getCharacterChanges)(Object(M.getInitialCharacter)(),l)).length){a.next=10;break}return t&&E.a.error("\u0412 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c"),a.abrupt("return");case 10:if(0!==(i=Object(H.getCharacterChanges)(s,l)).length){a.next=14;break}return t&&E.a.error("\u0412 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c"),a.abrupt("return");case 14:if(!(l.stats.skillPoints<0)){a.next=17;break}return t&&E.a.error("\u041e\u0447\u043a\u0438 \u041d\u0430\u0432\u044b\u043a\u043e\u0432 (\u041e\u041d) \u043d\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438!"),a.abrupt("return");case 17:E.a.success("\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d"),B.default.setCharacter({uid:n,character:l}),B.default.sendMessage({uid:n,message:"\u0425\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b",data:{characterChanges:i}});case 20:case"end":return a.stop()}}),a)}))),e.changeBio=function(a){return e.setState({character:Object(s.a)(Object(s.a)({},e.state.character),{},{bio:a.currentTarget.value})})},e.downloadCharacter=function(){var a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e.props.character)),t=document.createElement("a");t.setAttribute("href",a),t.setAttribute("download","character_".concat(Date.now(),".json")),t.click(),t.remove(),E.a.success("\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043a\u0430\u0447\u0430\u043d!")},e.getControls=function(){var a=e.props.character,t=e.state.character;return u.a.createElement("div",{className:"char-controls"},u.a.createElement(N.a,{title:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438?",okText:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c",cancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",onConfirm:function(){e.setState({character:Object(M.getInitialCharacter)()}),E.a.success("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u0431\u0440\u043e\u0448\u0435\u043d\u043e!")}},u.a.createElement(O.a,null,u.a.createElement(k.a,null),"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c")),u.a.createElement(N.a,{title:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0430?",okText:"\u0414\u0430",cancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",onConfirm:e.downloadCharacter},u.a.createElement(O.a,null,u.a.createElement(y,null),"\u042d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c")),u.a.createElement(N.a,{title:"\u041e\u0442\u043a\u0430\u0442\u0438\u0442\u044c \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",okText:"\u041e\u0442\u043a\u0430\u0442\u0438\u0442\u044c",cancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",disabled:a===t,onConfirm:function(){e.setState({character:e.props.character}),E.a.success("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0442\u043a\u0430\u0447\u0435\u043d\u043e!")}},u.a.createElement(O.a,{disabled:a===t},u.a.createElement(w.a,null),"\u041e\u0442\u043a\u0430\u0442\u0438\u0442\u044c")),u.a.createElement(N.a,{title:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f?",okText:"\u0414\u0430",cancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",disabled:a===t,onConfirm:function(){return e.onSave(!0)}},u.a.createElement(O.a,{disabled:a===t},u.a.createElement(T.a,null),"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")))},e.getTitle=function(e){return u.a.createElement(u.a.Fragment,null,u.a.createElement(R.a,null)," ","\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 \u0438\u0433\u0440\u043e\u043a\u0430 ",e.nickname||e.uid)},e.getBio=function(a){return u.a.createElement("div",{className:"char-bio"},u.a.createElement(f.a.TextArea,{disabled:!e.props.hasRight,minLength:3,value:a.bio,onChange:e.changeBio}))},e.render=function(){var a=e.props,t=a.user,c=a.hasRight,r=a.character,n=a.loading,s=e.state.character;return t&&r&&r.uid&&!n?u.a.createElement(v.a,{className:"char",title:e.getTitle(t),extra:c&&e.getControls()},u.a.createElement("div",null,u.a.createElement("div",null,e.getSpecial(s),e.getStats(s)),u.a.createElement("div",null,e.getSkills(s))),u.a.createElement("div",null,e.getMainStats(s)),e.getBio(s)):u.a.createElement(C.a,{description:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d"})},e}return t}(h.Component);a.default=Object(d.g)(Object(p.b)((function(e,a){var t=Object(H.getStateUser)(e,a),c=t.user,r=t.currentUser,n=t.character,l=!!c&&!!r&&r.approved&&(r.uid===c.uid&&n&&!n.static||r.isAdmin);return Object(s.a)(Object(s.a)({},t),{},{hasRight:l})}))(U))},469:function(e,a,t){},511:function(e,a,t){"use strict";var c=t(0),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},n=t(14),s=function(e,a){return c.createElement(n.a,Object.assign({},e,{ref:a,icon:r}))};s.displayName="RollbackOutlined";a.a=c.forwardRef(s)},512:function(e,a,t){"use strict";var c=t(0),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},n=t(14),s=function(e,a){return c.createElement(n.a,Object.assign({},e,{ref:a,icon:r}))};s.displayName="SaveOutlined";a.a=c.forwardRef(s)}}]);
//# sourceMappingURL=11.e7ee96c2.chunk.js.map