(this["webpackJsonptext-roleplay"]=this["webpackJsonptext-roleplay"]||[]).push([[0],{182:function(e){e.exports=JSON.parse('{"apiKey":"AIzaSyC_NJqbSuXGDiD6hcQZdmtBZnaVZ40ggIY","authDomain":"text-roleplay.firebaseapp.com","databaseURL":"https://text-roleplay.firebaseio.com","projectId":"text-roleplay","storageBucket":"text-roleplay.appspot.com","messagingSenderId":"226797822488","appId":"1:226797822488:web:e717b14d3ccc42e700996d"}')},190:function(e,t,a){e.exports=a(360)},199:function(e,t,a){},200:function(e,t,a){},348:function(e,t,a){},360:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),c=a.n(s),o=a(20),i=(a(199),a(36)),u=a(365),l=a(46),g=a(93),m=a(104),d=a(102),p=a(368),S=a(367),E=a(362),b=a(366),f=(a(200),a(32)),h=a(7),v=a(42),O=a(185),j=a(162),y=a(134),w=JSON.parse(localStorage.getItem("user")||"null"),I={user:w,isLoggedIn:null!==w,settings:!1,loading:!1,messages:[],users:{}},T={nickname:"",avatar:"",uid:""},G=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":case"GET_MESSAGES":case"GET_MORE_MESSAGES":case"SEND_MESSAGE":case"GET_SETTINGS":case"SET_SETTINGS":return Object(h.a)(Object(h.a)({},e),{},{loading:!0});case"LOGIN_FAIL":case"GET_MESSAGES_FAIL":case"GET_MORE_MESSAGES_SUCCESS":case"GET_MORE_MESSAGES_FAIL":case"SEND_MESSAGE_FAIL":case"GET_SETTINGS_FAIL":case"SET_SETTINGS_SUCCESS":case"SET_SETTINGS_FAIL":return Object(h.a)(Object(h.a)({},e),{},{loading:!1});case"LOGIN_SUCCESS":return Object(h.a)(Object(h.a)({},e),{},{user:t.user,isLoggedIn:null!==t.user});case"LOGOUT":return Object(h.a)(Object(h.a)({},e),{},{user:null,isLoggedIn:!1});case"GET_MESSAGES_SUCCESS":var a=t.concat?[].concat(Object(y.a)(e.messages),Object(y.a)(t.messages)):t.messages;return Object(h.a)(Object(h.a)({},e),{},{messages:a.sort((function(e,t){return parseInt(t.time)-parseInt(e.time)})).filter((function(e,t,a){return a.findIndex((function(t){return t.time===e.time}))===t})),loading:!1});case"GET_SETTINGS_SUCCESS":return Object(h.a)(Object(h.a)({},e),{},{settings:t.settings||T,loading:!1});case"GET_USER_SUCCESS":return Object(h.a)(Object(h.a)({},e),{},{users:Object(h.a)(Object(h.a)({},e.users),{},Object(f.a)({},t.user.uid,t.user))});default:return e}},_=Object(O.a)(),M=Object(v.createStore)(G,I,Object(j.composeWithDevTools)(Object(v.applyMiddleware)(_))),x=function(e){return{isLoggedIn:e.isLoggedIn}},k=function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);for(var n="#",r=0;r<3;r++){n+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return n},C=M.dispatch,N=function(e){return function(t){return C(Object(h.a)({type:e},t))}},A=function(e){var t,a=e.toLowerCase().replace(/_./g,(function(e){return e.toUpperCase()})).replace(/_/g,"");return t={},Object(f.a)(t,a,N(e)),Object(f.a)(t,"".concat(a,"Success"),N("".concat(e,"_SUCCESS"))),Object(f.a)(t,"".concat(a,"Fail"),N("".concat(e,"_FAIL"))),t},L=Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)({},A("LOGIN")),A("GET_USER")),A("GET_MESSAGES")),A("GET_MORE_MESSAGES")),A("GET_SETTINGS")),A("SET_SETTINGS")),A("SEND_MESSAGE")),A("SUBSCRIBE")),A("UNSUBSCRIBE")),{},{logout:N("LOGOUT")}),U=a(364),D=a(183),F=a(187),B=a(361),R=function(e){var t=e.avatar,a=e.nickname,n=e.style,s=Object(F.a)(e,["avatar","nickname","style"]);return r.a.createElement(B.a,Object.assign({src:t,style:Object(h.a)(Object(h.a)({},n),{},{backgroundColor:t?"transparent":k(a)})},s),a)},K=function(e){return 1==="".concat(e).length?"0".concat(e):e},J=function(e){var t=e.message,a=(t.author,t.time),n=t.body,s=e.user,c=new Date(a),o=[c.getHours(),c.getMinutes(),c.getSeconds()].map(K).join(":"),u=[c.getDate(),c.getMonth()+1,c.getFullYear()].map(K).join("."),l=s&&r.a.createElement(i.b,{to:"/user/".concat(s.uid)},r.a.createElement("div",{className:"chat-message__title"},r.a.createElement(R,{avatar:s.avatar,nickname:s.nickname}),r.a.createElement("div",{className:"chat-message__nickname"},s.nickname)));return r.a.createElement(U.a,{className:"chat-message",title:l,key:a,extra:r.a.createElement(D.a,{title:u},r.a.createElement("div",{className:"chat-time"},o))},n)},z=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={message:"",sending:!1},e.componentDidMount=function(){L.getMessages({}),L.subscribe({}),e.setState({message:localStorage.getItem("message")||""})},e.componentWillUnmount=function(){L.unsubscribe({})},e.componentDidUpdate=function(t){var a=e.props,n=a.messages,r=a.users;e.state.sending&&t.messages!==n&&(localStorage.setItem("message",""),e.setState({message:"",sending:!1})),n.forEach((function(e){r[e.author]||L.getUser({uid:e.author})}))},e.onChangeMessage=function(t){var a=t.target.value;localStorage.setItem("message",a),e.setState({message:a})},e.onKeyDown=function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.onSendMessage())},e.onSendMessage=function(){var t=e.state.message,a=e.props,n=a.settings,r=a.user;a.loading||(r&&n?n.nickname?t?(e.setState({sending:!0}),L.sendMessage({uid:r.uid,message:t})):S.a.error("Message is empty"):S.a.error("User name is not defined. Go to settings and set it"):S.a.error("Not logged in. How are you even here? Contact administration"))},e.getTime=function(e){var t=new Date(e);return"".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds())},e.getMoreMessages=function(){L.getMoreMessages({firstMessage:e.props.messages[e.props.messages.length-1]})},e.onScroll=function(t){t.target.scrollTop<=50&&e.getMoreMessages()},e.render=function(){var t=e.props,a=t.messages,n=t.loading,s=t.users;return r.a.createElement(E.a,{spinning:n},r.a.createElement("div",{className:"chat-wrapper"},r.a.createElement("div",{className:"chat-body",onScroll:e.onScroll},a.map((function(e){return r.a.createElement(J,{key:e.time,message:e,user:s[e.author]})}))),r.a.createElement("div",{className:"chat-controls"},r.a.createElement(b.a.TextArea,{placeholder:"Enter message",autoSize:{minRows:1,maxRows:10},onChange:e.onChangeMessage,onKeyDown:e.onKeyDown,value:e.state.message}),r.a.createElement(p.a,{onClick:e.onSendMessage}))))},e}return a}(n.Component),P=Object(o.b)((function(e){return{messages:e.messages,user:e.user,settings:e.settings,loading:e.loading,users:e.users}}))(z),W=a(135),q=a(133),H=a(73),V=a(369),Z=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state=T,e.componentDidMount=function(){var t=e.props.user;t&&L.getSettings({uid:t.uid})},e.onChange=function(t){return function(a){return e.setState(Object(f.a)({},t,a.target.value))}},e.getNewSettings=function(){var t=e.props.settings,a={};return Object.entries(t).forEach((function(t){var n=Object(W.a)(t,2),r=n[0],s=n[1];a[r]=e.state[r]||s})),a},e.onSubmit=function(){e.setSettings(e.getNewSettings())},e.setSettings=function(t){var a=e.props.user;a&&L.setSettings({uid:a.uid,settings:t})},e.getField=function(t,a){var n=e.props,s=n.loading,c=n.settings,o=e.state,i=o.avatar,u=o.nickname;switch(t){case"avatar":return r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(b.a,{defaultValue:i||a,onChange:e.onChange(t),disabled:s}),r.a.createElement(q.a,{onClick:function(){return e.setSettings(Object(h.a)(Object(h.a)({},e.getNewSettings()),{},{avatar:""}))},disabled:!(i||a)},r.a.createElement(V.a,null))),r.a.createElement(R,{avatar:i||a,nickname:u||c&&c.nickname||"",size:128,style:{margin:"8px auto",display:"block"}}));case"uid":return!1;default:return r.a.createElement(b.a,{defaultValue:a,onChange:e.onChange(t),disabled:s})}},e.render=function(){var t=e.props,a=t.settings,n=t.loading;return a?r.a.createElement("div",null,r.a.createElement(E.a,{spinning:n},Object.entries(a).map((function(t){var a=Object(W.a)(t,2),n=a[0],s=a[1],c=e.getField(n,s);return c&&r.a.createElement(U.a,{key:n,title:n.toUpperCase()},c)}))),r.a.createElement(q.a,{onClick:e.onSubmit,disabled:n},"Submit")):r.a.createElement(H.a,null)},e}return a}(r.a.Component),Y=Object(o.b)((function(e){return{settings:e.settings,loading:e.loading,user:e.user}}))(Z),Q=[{label:"Chat",path:"/chat",component:P},{label:"Settings",path:"/settings",component:Y},{label:"Logout",path:"/logout",component:Object(o.b)()((function(){return r.a.createElement("div",null,r.a.createElement(B.a,{src:"https://cdn.lowgif.com/full/fc3d7d9abd06a92e-hi-bear-gifs-get-the-best-gif-on-giphy.gif",size:256,style:{margin:"0 auto",display:"block"}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(q.a,{type:"primary",size:"large",onClick:function(){return L.logout({})},style:{width:"100%"}},"Logout"))}))}];var X=Object(o.b)(x)(Object(l.g)((function(e){return e.isLoggedIn?r.a.createElement(u.a,{style:{width:256},mode:"inline",selectedKeys:[e.location.pathname]},Q.map((function(t){return r.a.createElement(u.a.Item,{key:t.path,disabled:t.path===e.location.pathname},r.a.createElement(i.b,{to:t.path},t.label))}))):r.a.createElement(r.a.Fragment,null)}))),$=a(363),ee=Object(o.b)(x)((function(e){return e.isLoggedIn?r.a.createElement(l.a,{to:"/chat"}):r.a.createElement($.a,{onFinish:function(e){return L.login(e)}},r.a.createElement($.a.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email!"}]},r.a.createElement(b.a,null)),r.a.createElement($.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},r.a.createElement(b.a.Password,null)),r.a.createElement($.a.Item,null,r.a.createElement(q.a,{type:"primary",htmlType:"submit"},"Login")))}));var te=Object(o.b)(x)((function(e){return r.a.createElement(l.d,null,Q.map((function(t){return r.a.createElement(l.b,{key:t.path,path:t.path,component:e.isLoggedIn?t.component:ee})})),r.a.createElement(l.a,{from:"/",to:"/chat",exact:!0}),r.a.createElement(l.a,{from:"/text-roleplay",to:"/chat",exact:!0}),r.a.createElement(l.b,{path:"*"},r.a.createElement(U.a,null,r.a.createElement(H.a,{description:"404 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430"}),r.a.createElement("br",null),r.a.createElement(U.a.Meta,{description:r.a.createElement(i.b,{to:"/chat"},r.a.createElement(q.a,{type:"primary",style:{width:"100%"}},"Go to working page"))}))))}));a(348),a(349);var ae=function(){return r.a.createElement(i.a,null,r.a.createElement(X,null),r.a.createElement("div",{className:"app"},r.a.createElement(te,null)))},ne=a(16),re=a.n(ne),se=a(30),ce=a(181),oe=a.n(ce),ie=a(182),ue=oe.a.initializeApp(ie),le=ue.auth(),ge=ue.database();le.onAuthStateChanged((function(e){e?(L.loginSuccess({user:e}),L.getSettings({uid:e.uid})):L.logout({})}));var me=re.a.mark(ve),de=re.a.mark(Oe),pe=re.a.mark(je),Se=re.a.mark(ye),Ee=re.a.mark(we),be=re.a.mark(Ge),fe=re.a.mark(_e),he=re.a.mark(ke);function ve(e){var t,a,n,r;return re.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.email,a=e.password,s.prev=1,s.next=4,le.signInWithEmailAndPassword(t,a);case 4:n=s.sent,L.loginSuccess({user:n}),localStorage.setItem("user",JSON.stringify(n.user)),s.next=13;break;case 9:s.prev=9,s.t0=s.catch(1),console.error(s.t0),"auth/user-not-found"===s.t0.code?(r=le.createUserWithEmailAndPassword(t,a),L.loginSuccess({user:r}),localStorage.setItem("user",JSON.stringify(r))):L.loginFail({error:s.t0});case 13:case"end":return s.stop()}}),me,null,[[1,9]])}function Oe(){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.setItem("loggedIn","false"),e.next=3,le.signOut();case 3:case"end":return e.stop()}}),de)}function je(e){var t,a,n;return re.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.uid,r.prev=1,r.next=4,ge.ref("settings").child(t).once("value");case 4:a=r.sent,n=a.val(),L.getSettingsSuccess({settings:n}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),console.error(r.t0),L.getSettingsFail({error:r.t0});case 13:case"end":return r.stop()}}),pe,null,[[1,9]])}function ye(e){var t,a;return re.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.uid,a=e.settings,n.prev=1,n.next=4,ge.ref("settings").child(t).set(Object(h.a)(Object(h.a)({},a),{},{uid:t}));case 4:L.setSettingsSuccess({}),L.getSettings({uid:t}),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(1),console.error(n.t0),L.setSettingsFail({error:n.t0});case 12:case"end":return n.stop()}}),Se,null,[[1,8]])}function we(e){var t,a,n;return re.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.uid,a=e.message,n=(new Date).getTime(),r.prev=2,r.next=5,ge.ref("messages").child("".concat(n)).set({time:n,author:t,body:a});case 5:localStorage.setItem("message",""),L.sendMessageSuccess({}),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(2),console.error(r.t0),L.sendMessageFail({error:r.t0});case 13:case"end":return r.stop()}}),Ee,null,[[2,9]])}function Ie(){ge.ref("messages").orderByKey().limitToLast(1).on("value",(function(e){var t=Object.values(e.val()||{});L.getMessagesSuccess({messages:t,concat:!0})}))}function Te(){ge.ref("messages").off()}function Ge(){var e,t;return re.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,ge.ref("messages").orderByKey().limitToLast(30).once("value");case 2:e=a.sent,t=Object.values(e.val()||{}),L.getMessagesSuccess({messages:t});case 5:case"end":return a.stop()}}),be)}function _e(e){var t,a,n;return re.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.firstMessage,r.next=3,ge.ref("messages").orderByKey().endAt("".concat(t.time)).limitToLast(5).once("value");case 3:a=r.sent,n=Object.values(a.val()||{}),L.getMessagesSuccess({messages:n,concat:!0});case 6:case"end":return r.stop()}}),fe)}var Me={};function xe(e){var t=e.uid;Me[t]||(Me[t]=!0,console.log("sub",t,(new Date).getTime()),ge.ref("settings").child(t).on("value",(function(e){var t=e.val()||{};L.getUserSuccess({user:t})})))}function ke(){return re.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(se.a)("LOGIN",ve);case 2:return e.next=4,Object(se.a)("LOGOUT",Oe);case 4:return e.next=6,Object(se.a)("GET_SETTINGS",je);case 6:return e.next=8,Object(se.a)("GET_USER",xe);case 8:return e.next=10,Object(se.a)("SET_SETTINGS",ye);case 10:return e.next=12,Object(se.a)("SEND_MESSAGE",we);case 12:return e.next=14,Object(se.a)("GET_MESSAGES",Ge);case 14:return e.next=16,Object(se.a)("GET_MORE_MESSAGES",_e);case 16:return e.next=18,Object(se.a)("SUBSCRIBE",Ie);case 18:return e.next=20,Object(se.a)("UNSUBSCRIBE",Te);case 20:case"end":return e.stop()}}),he)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));_.run(ke),c.a.render(r.a.createElement(o.a,{store:M},r.a.createElement(ae,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[190,1,2]]]);
//# sourceMappingURL=main.d561cf02.chunk.js.map